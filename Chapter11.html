<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.531">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>비즈니스 애널리틱스 (Business Analytics) - 11&nbsp; k-평균 군집분석</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter10.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter11.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">k-평균 군집분석</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">비즈니스 애널리틱스 (Business Analytics)</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">오리엔테이션</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">통계학의 본질과 변수의 이해</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">기술통계와 요약</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">일원배치 분산분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">이원배치 분산분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">회귀분석: 통계의 꽃</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">조절효과와 매개효과</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">차원축소와 주성분 분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">요인분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">계층적 군집분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter11.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">k-평균 군집분석</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#k-평균-군집분석이란" id="toc-k-평균-군집분석이란" class="nav-link active" data-scroll-target="#k-평균-군집분석이란"><span class="header-section-number">11.1</span> k-평균 군집분석이란?</a>
  <ul class="collapse">
  <li><a href="#군집분석의-한-종류로서의-k-평균" id="toc-군집분석의-한-종류로서의-k-평균" class="nav-link" data-scroll-target="#군집분석의-한-종류로서의-k-평균"><span class="header-section-number">11.1.1</span> 군집분석의 한 종류로서의 K-평균</a></li>
  <li><a href="#작동-원리" id="toc-작동-원리" class="nav-link" data-scroll-target="#작동-원리"><span class="header-section-number">11.1.2</span> 작동 원리</a></li>
  <li><a href="#계층적-군집분석과의-비교" id="toc-계층적-군집분석과의-비교" class="nav-link" data-scroll-target="#계층적-군집분석과의-비교"><span class="header-section-number">11.1.3</span> 계층적 군집분석과의 비교</a></li>
  <li><a href="#외식산업-예시" id="toc-외식산업-예시" class="nav-link" data-scroll-target="#외식산업-예시"><span class="header-section-number">11.1.4</span> 외식산업 예시</a></li>
  <li><a href="#거리-개념의-이해" id="toc-거리-개념의-이해" class="nav-link" data-scroll-target="#거리-개념의-이해"><span class="header-section-number">11.1.5</span> 거리 개념의 이해</a></li>
  <li><a href="#r을-활용한-간단한-예제" id="toc-r을-활용한-간단한-예제" class="nav-link" data-scroll-target="#r을-활용한-간단한-예제"><span class="header-section-number">11.1.6</span> R을 활용한 간단한 예제</a></li>
  <li><a href="#분석의-활용-가치" id="toc-분석의-활용-가치" class="nav-link" data-scroll-target="#분석의-활용-가치"><span class="header-section-number">11.1.7</span> 분석의 활용 가치</a></li>
  </ul></li>
  <li><a href="#알고리즘-절차" id="toc-알고리즘-절차" class="nav-link" data-scroll-target="#알고리즘-절차"><span class="header-section-number">11.2</span> 알고리즘 절차</a>
  <ul class="collapse">
  <li><a href="#외식산업-시나리오로-시작해-보기" id="toc-외식산업-시나리오로-시작해-보기" class="nav-link" data-scroll-target="#외식산업-시나리오로-시작해-보기"><span class="header-section-number">11.2.1</span> 외식산업 시나리오로 시작해 보기</a></li>
  <li><a href="#k-값-결정은-출발선-정하기와-같다" id="toc-k-값-결정은-출발선-정하기와-같다" class="nav-link" data-scroll-target="#k-값-결정은-출발선-정하기와-같다"><span class="header-section-number">11.2.2</span> K 값 결정은 출발선 정하기와 같다</a></li>
  <li><a href="#초기-중심-설정은-첫-단추를-끼우는-일이다" id="toc-초기-중심-설정은-첫-단추를-끼우는-일이다" class="nav-link" data-scroll-target="#초기-중심-설정은-첫-단추를-끼우는-일이다"><span class="header-section-number">11.2.3</span> 초기 중심 설정은 첫 단추를 끼우는 일이다</a></li>
  <li><a href="#할당-단계는-각-매장을-가장-가까운-중심에-맡기는-일이다" id="toc-할당-단계는-각-매장을-가장-가까운-중심에-맡기는-일이다" class="nav-link" data-scroll-target="#할당-단계는-각-매장을-가장-가까운-중심에-맡기는-일이다"><span class="header-section-number">11.2.4</span> 할당 단계는 각 매장을 가장 가까운 중심에 맡기는 일이다</a></li>
  <li><a href="#중심-갱신은-각-군집의-평균을-다시-계산하는-일이다" id="toc-중심-갱신은-각-군집의-평균을-다시-계산하는-일이다" class="nav-link" data-scroll-target="#중심-갱신은-각-군집의-평균을-다시-계산하는-일이다"><span class="header-section-number">11.2.5</span> 중심 갱신은 각 군집의 평균을 다시 계산하는 일이다</a></li>
  <li><a href="#반복은-경계가-더-이상-움직이지-않을-때까지-계속된다" id="toc-반복은-경계가-더-이상-움직이지-않을-때까지-계속된다" class="nav-link" data-scroll-target="#반복은-경계가-더-이상-움직이지-않을-때까지-계속된다"><span class="header-section-number">11.2.6</span> 반복은 경계가 더 이상 움직이지 않을 때까지 계속된다</a></li>
  <li><a href="#종료-조건은-더-이상-바뀌지-않는다는-신호다" id="toc-종료-조건은-더-이상-바뀌지-않는다는-신호다" class="nav-link" data-scroll-target="#종료-조건은-더-이상-바뀌지-않는다는-신호다"><span class="header-section-number">11.2.7</span> 종료 조건은 더 이상 바뀌지 않는다는 신호다</a></li>
  <li><a href="#em-관점으로-연결하면-머릿속-정리가-빨라진다" id="toc-em-관점으로-연결하면-머릿속-정리가-빨라진다" class="nav-link" data-scroll-target="#em-관점으로-연결하면-머릿속-정리가-빨라진다"><span class="header-section-number">11.2.8</span> EM 관점으로 연결하면 머릿속 정리가 빨라진다</a></li>
  <li><a href="#결과를-외식-전략으로-번역해야-분석이-힘을-가진다" id="toc-결과를-외식-전략으로-번역해야-분석이-힘을-가진다" class="nav-link" data-scroll-target="#결과를-외식-전략으로-번역해야-분석이-힘을-가진다"><span class="header-section-number">11.2.9</span> 결과를 외식 전략으로 번역해야 분석이 힘을 가진다</a></li>
  </ul></li>
  <li><a href="#주요-알고리즘" id="toc-주요-알고리즘" class="nav-link" data-scroll-target="#주요-알고리즘"><span class="header-section-number">11.3</span> 주요 알고리즘</a>
  <ul class="collapse">
  <li><a href="#외식산업-시나리오" id="toc-외식산업-시나리오" class="nav-link" data-scroll-target="#외식산업-시나리오"><span class="header-section-number">11.3.1</span> 외식산업 시나리오</a></li>
  <li><a href="#lloyd-알고리즘" id="toc-lloyd-알고리즘" class="nav-link" data-scroll-target="#lloyd-알고리즘"><span class="header-section-number">11.3.2</span> Lloyd 알고리즘</a></li>
  <li><a href="#forgy-알고리즘" id="toc-forgy-알고리즘" class="nav-link" data-scroll-target="#forgy-알고리즘"><span class="header-section-number">11.3.3</span> Forgy 알고리즘</a></li>
  <li><a href="#macqueen-방법" id="toc-macqueen-방법" class="nav-link" data-scroll-target="#macqueen-방법"><span class="header-section-number">11.3.4</span> MacQueen 방법</a></li>
  <li><a href="#hartiganwong-방법" id="toc-hartiganwong-방법" class="nav-link" data-scroll-target="#hartiganwong-방법"><span class="header-section-number">11.3.5</span> Hartigan–Wong 방법</a></li>
  <li><a href="#알고리즘-비교" id="toc-알고리즘-비교" class="nav-link" data-scroll-target="#알고리즘-비교"><span class="header-section-number">11.3.6</span> 알고리즘 비교</a></li>
  </ul></li>
  <li><a href="#k-값-결정-방법" id="toc-k-값-결정-방법" class="nav-link" data-scroll-target="#k-값-결정-방법"><span class="header-section-number">11.4</span> K 값 결정 방법</a>
  <ul class="collapse">
  <li><a href="#왜-k-값을-결정해야-하는가" id="toc-왜-k-값을-결정해야-하는가" class="nav-link" data-scroll-target="#왜-k-값을-결정해야-하는가"><span class="header-section-number">11.4.1</span> 왜 K 값을 결정해야 하는가?</a></li>
  <li><a href="#덴드로그램을-이용한-방법" id="toc-덴드로그램을-이용한-방법" class="nav-link" data-scroll-target="#덴드로그램을-이용한-방법"><span class="header-section-number">11.4.2</span> 덴드로그램을 이용한 방법</a></li>
  <li><a href="#팔꿈치-방법" id="toc-팔꿈치-방법" class="nav-link" data-scroll-target="#팔꿈치-방법"><span class="header-section-number">11.4.3</span> 팔꿈치 방법</a></li>
  <li><a href="#실루엣-계수-방법" id="toc-실루엣-계수-방법" class="nav-link" data-scroll-target="#실루엣-계수-방법"><span class="header-section-number">11.4.4</span> 실루엣 계수 방법</a></li>
  <li><a href="#방법-비교와-해석" id="toc-방법-비교와-해석" class="nav-link" data-scroll-target="#방법-비교와-해석"><span class="header-section-number">11.4.5</span> 방법 비교와 해석</a></li>
  </ul></li>
  <li><a href="#k-평균-군집분석의-특징과-유의점" id="toc-k-평균-군집분석의-특징과-유의점" class="nav-link" data-scroll-target="#k-평균-군집분석의-특징과-유의점"><span class="header-section-number">11.5</span> K-평균 군집분석의 특징과 유의점</a>
  <ul class="collapse">
  <li><a href="#계산-속도와-확장성" id="toc-계산-속도와-확장성" class="nav-link" data-scroll-target="#계산-속도와-확장성"><span class="header-section-number">11.5.1</span> 계산 속도와 확장성</a></li>
  <li><a href="#구현의-단순함" id="toc-구현의-단순함" class="nav-link" data-scroll-target="#구현의-단순함"><span class="header-section-number">11.5.2</span> 구현의 단순함</a></li>
  <li><a href="#k-값-결정과-초기-중심의-영향" id="toc-k-값-결정과-초기-중심의-영향" class="nav-link" data-scroll-target="#k-값-결정과-초기-중심의-영향"><span class="header-section-number">11.5.3</span> K 값 결정과 초기 중심의 영향</a></li>
  <li><a href="#아웃라이어의-영향" id="toc-아웃라이어의-영향" class="nav-link" data-scroll-target="#아웃라이어의-영향"><span class="header-section-number">11.5.4</span> 아웃라이어의 영향</a></li>
  <li><a href="#군집-크기와-모양의-제약" id="toc-군집-크기와-모양의-제약" class="nav-link" data-scroll-target="#군집-크기와-모양의-제약"><span class="header-section-number">11.5.5</span> 군집 크기와 모양의 제약</a></li>
  <li><a href="#표준화의-필요성" id="toc-표준화의-필요성" class="nav-link" data-scroll-target="#표준화의-필요성"><span class="header-section-number">11.5.6</span> 표준화의 필요성</a></li>
  <li><a href="#종합적-해석" id="toc-종합적-해석" class="nav-link" data-scroll-target="#종합적-해석"><span class="header-section-number">11.5.7</span> 종합적 해석</a></li>
  </ul></li>
  <li><a href="#k-평균-군집분석-실습" id="toc-k-평균-군집분석-실습" class="nav-link" data-scroll-target="#k-평균-군집분석-실습"><span class="header-section-number">11.6</span> k-평균 군집분석 실습</a>
  <ul class="collapse">
  <li><a href="#실습-시나리오" id="toc-실습-시나리오" class="nav-link" data-scroll-target="#실습-시나리오"><span class="header-section-number">11.6.1</span> 실습 시나리오</a></li>
  <li><a href="#실습-데이터" id="toc-실습-데이터" class="nav-link" data-scroll-target="#실습-데이터"><span class="header-section-number">11.6.2</span> 실습 데이터</a></li>
  <li><a href="#분석-절차" id="toc-분석-절차" class="nav-link" data-scroll-target="#분석-절차"><span class="header-section-number">11.6.3</span> 분석 절차</a></li>
  <li><a href="#k-평균-적용과-결과-비교" id="toc-k-평균-적용과-결과-비교" class="nav-link" data-scroll-target="#k-평균-적용과-결과-비교"><span class="header-section-number">11.6.4</span> K-평균 적용과 결과 비교</a></li>
  <li><a href="#결과-해석과-전략-제시" id="toc-결과-해석과-전략-제시" class="nav-link" data-scroll-target="#결과-해석과-전략-제시"><span class="header-section-number">11.6.5</span> 결과 해석과 전략 제시</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">k-평균 군집분석</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="k-평균-군집분석이란" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="k-평균-군집분석이란"><span class="header-section-number">11.1</span> k-평균 군집분석이란?</h2>
<section id="군집분석의-한-종류로서의-k-평균" class="level3" data-number="11.1.1">
<h3 data-number="11.1.1" class="anchored" data-anchor-id="군집분석의-한-종류로서의-k-평균"><span class="header-section-number">11.1.1</span> 군집분석의 한 종류로서의 K-평균</h3>
<p>k-평균 군집분석은 데이터를 몇 개의 그룹으로 나누는 <strong>비계층적 군집분석</strong> 방법 중 가장 널리 쓰이는 알고리즘이다. 계층적 군집분석이 나무 구조처럼 군집을 점차 합치거나 나누어가는 방식이라면, k-평균은 처음부터 <strong>군집의 개수 K를 정해 놓고</strong> 데이터를 그 개수만큼 나누는 방식이다. 즉, 모든 데이터는 정확히 하나의 군집에만 속하며, 어떤 군집이 다른 군집을 포함하는 관계는 없다. 이 방식은 <strong>계산 속도가 빠르고 대규모 데이터에 적용하기 적합</strong>하다는 장점이 있다. 예를 들어 1,000개의 매장 데이터를 분석해야 하는 외식 프랜차이즈 본사 입장에서, k-평균은 신속하게 매장들을 여러 유형으로 나눌 수 있는 도구가 된다.</p>
</section>
<section id="작동-원리" class="level3" data-number="11.1.2">
<h3 data-number="11.1.2" class="anchored" data-anchor-id="작동-원리"><span class="header-section-number">11.1.2</span> 작동 원리</h3>
<p>k-평균 알고리즘은 먼저 K개의 중심점(centroid)을 임의로 정한 뒤, 각 데이터 포인트를 가장 가까운 중심점에 할당한다. 그런 다음 각 군집에 속한 데이터의 평균값을 계산해 새로운 중심점을 만들고, 다시 모든 데이터를 가장 가까운 중심점에 재할당한다. 이 과정을 중심점의 위치가 더 이상 변하지 않을 때까지 반복한다. 거리 계산에는 주로 <strong>유클리드 거리</strong>가 사용되며, 이는 지도에서 두 지점 사이의 직선 거리를 구하는 것과 유사하다. 예를 들어, 서울 강남구에 있는 고급 레스토랑과 부산 해운대의 해산물 전문점은 방문객 수, 객단가, 리뷰 평점 등 여러 변수를 고려했을 때 서로 거리가 멀게 계산될 수 밖에 없다.</p>
</section>
<section id="계층적-군집분석과의-비교" class="level3" data-number="11.1.3">
<h3 data-number="11.1.3" class="anchored" data-anchor-id="계층적-군집분석과의-비교"><span class="header-section-number">11.1.3</span> 계층적 군집분석과의 비교</h3>
<p>계층적 군집분석은 덴드로그램(dendrogram)이라는 시각화로 군집 형성 과정을 보여주며, 작은 군집이 큰 군집에 포함되는 <strong>포함 관계(nested)</strong>가 가능하다. 반면 k-평균은 각 데이터가 단 하나의 군집에만 속하는 <strong>분할 관계(partitioned)</strong>를 가진다. 예를 들어 전국 300개 외식 매장을 분석할 때, 계층적 방법은 ’도시별 <span class="math inline">\(\rightarrow\)</span> 업종별’처럼 단계적 그룹을 만들 수 있지만, k-평균은 분석 시작 단계에서 <span class="math inline">\(K = 5\)</span>와 같이 군집 개수를 정해 놓고 매장을 다섯 그룹으로 나누는 식이다.</p>
</section>
<section id="외식산업-예시" class="level3" data-number="11.1.4">
<h3 data-number="11.1.4" class="anchored" data-anchor-id="외식산업-예시"><span class="header-section-number">11.1.4</span> 외식산업 예시</h3>
<p>한 프랜차이즈 커피전문점 본사가 매장 운영 전략을 세우기 위해 전국 매장을 k-평균으로 군집화한다고 가정해 보자. 분석 변수로는 월평균 매출액, 하루 평균 방문객 수, 1인당 평균 구매액, 고객 만족도 점수를 사용할 수 있다. K=3으로 설정하면, 분석 결과는 다음과 같이 나올 수 있다.</p>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 35%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>군집 번호</th>
<th>매출 규모</th>
<th>방문객 특성</th>
<th>특징</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>높음</td>
<td>유동인구 많음, 20~30대 중심</td>
<td>도심 상권의 대형 매장</td>
</tr>
<tr class="even">
<td>2</td>
<td>중간</td>
<td>단골 비중 높음, 중장년층 중심</td>
<td>주거지역 인근의 안정형 매장</td>
</tr>
<tr class="odd">
<td>3</td>
<td>낮음</td>
<td>유동인구 적음, 구매빈도 낮음</td>
<td>외곽지역의 소형 매장</td>
</tr>
</tbody>
</table>
<p>이렇게 구분된 군집은 각각 다른 전략을 적용할 수 있다. 예를 들어 1번 군집에는 프리미엄 신제품과 시즌 한정 메뉴를 집중적으로 마케팅하고, 2번 군집에는 멤버십 혜택 강화와 단골 유지를 위한 이벤트를 기획하며, 3번 군집에는 배달 서비스 확대나 상권 재평가를 통한 입지 개선이 필요할 수 있다.</p>
</section>
<section id="거리-개념의-이해" class="level3" data-number="11.1.5">
<h3 data-number="11.1.5" class="anchored" data-anchor-id="거리-개념의-이해"><span class="header-section-number">11.1.5</span> 거리 개념의 이해</h3>
<p>여전히 <strong>거리 계산은 군집 분석의 핵심</strong>이다. 두 매장이 비슷한 판매 패턴을 보이면 거리 값이 작게 나오고, 차이가 크면 거리 값이 크게 나온다. 예를 들어 A매장은 월 매출 1억 원, 방문객 3,000명, 객단가 3,300원이고, B매장은 월 매출 9,000만 원, 방문객 2,900명, 객단가 3,200원이라면, 두 매장은 매우 가까운 거리에 있다고 판단된다. 반대로 C매장이 월 매출 5,000만 원, 방문객 1,500명, 객단가 4,500원이라면 A나 B와의 거리는 훨씬 멀어진다.</p>
</section>
<section id="r을-활용한-간단한-예제" class="level3" data-number="11.1.6">
<h3 data-number="11.1.6" class="anchored" data-anchor-id="r을-활용한-간단한-예제"><span class="header-section-number">11.1.6</span> R을 활용한 간단한 예제</h3>
<p>다음 코드는 가상의 외식 매장 데이터를 생성하고 k-평균 군집분석을 수행하는 예시다. 직접 데이터를 바꾸어 보면서 군집 결과가 어떻게 달라지는지 확인하면 개념 이해에 도움이 될 것이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 가상의 외식 매장 데이터 생성</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>store_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sales =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">1000</span>, <span class="dv">100</span>), <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">700</span>, <span class="dv">80</span>), <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">400</span>, <span class="dv">50</span>)),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">visitors =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">300</span>, <span class="dv">30</span>), <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">200</span>, <span class="dv">20</span>), <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">15</span>)),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">satisfaction =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="fl">4.5</span>, <span class="fl">0.3</span>), <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="fl">4.0</span>, <span class="fl">0.2</span>), <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="fl">3.5</span>, <span class="fl">0.4</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 표준화</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>store_data_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(store_data)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># k-평균 군집분석 수행</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(store_data_scaled, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 결과 확인</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>kmeans_result<span class="sc">$</span>cluster</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 3 3 3 3 3 3 3 3 3 3 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(store_data, <span class="at">by =</span> <span class="fu">list</span>(<span class="at">cluster =</span> kmeans_result<span class="sc">$</span>cluster), mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cluster     sales visitors satisfaction
1       1  716.6898 199.8257     3.927416
2       2  378.7721 103.3253     3.625238
3       3 1007.4626 309.6613     4.536925</code></pre>
</div>
</div>
<p>이 결과에서 각 군집별 평균 매출, 방문객 수, 만족도 점수를 비교해 보면, 어떤 특성을 가진 매장들이 한 그룹으로 묶였는지 한눈에 파악할 수 있다. 예를 들어 평균 매출과 방문객 수가 높은 군집은 도심 상권 매장일 가능성이 크고, 만족도는 높지만 매출이 낮은 군집은 외곽의 단골 중심 매장일 수 있다.</p>
</section>
<section id="분석의-활용-가치" class="level3" data-number="11.1.7">
<h3 data-number="11.1.7" class="anchored" data-anchor-id="분석의-활용-가치"><span class="header-section-number">11.1.7</span> 분석의 활용 가치</h3>
<p>k-평균 군집분석은 외식산업에서 단순히 매장을 분류하는 데서 끝나지 않는다. 군집별 특성을 분석해 매출 증대 전략, 메뉴 구성, 마케팅 채널 선택, 인력 배치 등에 직접 반영할 수 있다. 또한 시기별 데이터를 분석하면 계절 변화나 이벤트에 따른 군집 이동 패턴을 추적할 수 있어, 장기적인 경영 전략 수립에도 유용하다.</p>
</section>
</section>
<section id="알고리즘-절차" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="알고리즘-절차"><span class="header-section-number">11.2</span> 알고리즘 절차</h2>
<section id="외식산업-시나리오로-시작해-보기" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="외식산업-시나리오로-시작해-보기"><span class="header-section-number">11.2.1</span> 외식산업 시나리오로 시작해 보기</h3>
<p>프랜차이즈 본사가 전국 매장 300곳의 운영 데이터를 가지고 있다 가정한다. 이 데이터에는 하루 평균 방문객 수, 1인당 평균 구매액, 평균 체류 시간, 고객 만족도 점수가 들어 있다. 실제로 본사는 상권 특성에 따라 전략을 달리 해야 하므로 매장들을 비슷한 운영 패턴끼리 묶어 보고 싶다. 직관적으로는 도심 업무지구의 회전 빠른 매장, 주거지의 단골 중심 매장, 캠퍼스 인근의 저가·고빈도 매장 같은 유형이 기대된다. k-평균은 이런 직관을 데이터 기반 군집으로 명확히 만들어 준다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 생성</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">120</span>  <span class="co"># 도심 상권: 방문객 많고 객단가 높음</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># 주거 상권: 방문객 중간, 체류 길고 만족도 높음</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>n3 <span class="ot">&lt;-</span>  <span class="dv">80</span>  <span class="co"># 캠퍼스 상권: 방문객 많고 객단가 낮음</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>cluster1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="dv">320</span>, <span class="at">sd =</span> <span class="dv">30</span>),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="dv">7200</span>, <span class="at">sd =</span> <span class="dv">400</span>),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">stay   =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="dv">18</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">satis  =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.3</span>),</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seg =</span> <span class="st">"도심"</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>cluster2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="dv">200</span>, <span class="at">sd =</span> <span class="dv">25</span>),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="dv">6500</span>, <span class="at">sd =</span> <span class="dv">350</span>),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">stay   =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="dv">28</span>, <span class="at">sd =</span> <span class="dv">4</span>),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">satis  =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="fl">4.4</span>, <span class="at">sd =</span> <span class="fl">0.25</span>),</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">seg =</span> <span class="st">"주거"</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>cluster3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="dv">290</span>, <span class="at">sd =</span> <span class="dv">35</span>),</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="dv">5200</span>, <span class="at">sd =</span> <span class="dv">450</span>),</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">stay   =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="dv">16</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">satis  =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="fl">4.0</span>, <span class="at">sd =</span> <span class="fl">0.35</span>),</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">seg =</span> <span class="st">"캠퍼스"</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>stores <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cluster1, cluster2, cluster3)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>stores<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"S"</span>, <span class="fu">seq_len</span>(<span class="fu">nrow</span>(stores)))</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stores, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    visits   ticket     stay    satis  seg id
1 361.1288 6602.550 15.81235 3.845355 도심 S1
2 303.0591 6611.826 20.99421 3.773444 도심 S2
3 330.8939 7249.881 21.77544 3.954713 도심 S3</code></pre>
</div>
</div>
</section>
<section id="k-값-결정은-출발선-정하기와-같다" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="k-값-결정은-출발선-정하기와-같다"><span class="header-section-number">11.2.2</span> K 값 결정은 출발선 정하기와 같다</h3>
<p>k-평균은 군집 개수 <strong>K를 먼저 정한다는 제약이 있다.</strong> 실무에서는 계층적 군집의 덴드로그램, 팔꿈치 그래프, 실루엣 분석 등으로 후보 K를 좁혀 간다. 여기서는 표준화한 데이터에서 군집 내 제곱합의 총합을 그려 꺾이는 지점을 찾는다. 매장 수가 많고 변수 단위가 제각각이므로 <strong>표준화가 선행</strong>된다. 표준화 없이 유클리드 거리를 쓰면 단위가 큰 변수 하나가 결과를 지배할 위험이 크다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 필요 패키지</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2); <span class="fu">library</span>(dplyr)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(stores[, <span class="fu">c</span>(<span class="st">"visits"</span>,<span class="st">"ticket"</span>,<span class="st">"stay"</span>,<span class="st">"satis"</span>)])  <span class="co"># 표준화</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>wcss <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="cf">function</span>(k){</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(scaled, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>tot.withinss</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>elbow_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">wcss =</span> wcss)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elbow_df, <span class="fu">aes</span>(k, wcss)) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"팔꿈치 방법으로 본 K 후보"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"군집 개수 K"</span>, <span class="at">y =</span> <span class="st">"군집 내 제곱합 합계 (WCSS)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="초기-중심-설정은-첫-단추를-끼우는-일이다" class="level3" data-number="11.2.3">
<h3 data-number="11.2.3" class="anchored" data-anchor-id="초기-중심-설정은-첫-단추를-끼우는-일이다"><span class="header-section-number">11.2.3</span> 초기 중심 설정은 첫 단추를 끼우는 일이다</h3>
<p>초기 중심은 임의로 선택할 수도 있고, 계층적 군집 결과의 대표점을 가져올 수도 있다. 초기 중심이 극단적이면 지역해에 빠질 수 있으므로 보통 무작위 시작점을 여러 번 시도하는 nstart 전략을 쓴다. 현재 데이터에서는 K=3을 가정하고 무작위 초기 중심을 골라 화면에 올려 본다. 점 구름이 어떤 중심과 가까운지 시각적으로 가늠하는 것만으로도 군집의 대략을 파악할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2차원 시각화를 위해 핵심 두 변수만 먼저 그려 보기</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(stores, <span class="fu">aes</span>(visits, ticket)) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"방문객 수 vs 객단가: 초기 데이터 산점도"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"하루 평균 방문객 수"</span>, <span class="at">y =</span> <span class="st">"1인당 평균 구매액(원)"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>p0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 무작위 초기 중심(표준화 공간에서 선택)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>init_idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stores), K)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>centroids_z <span class="ot">&lt;-</span> scaled[init_idx, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>centroids_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> stores<span class="sc">$</span>visits[init_idx],</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> stores<span class="sc">$</span>ticket[init_idx],</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cid =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span>K)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stores, <span class="fu">aes</span>(visits, ticket)) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> centroids_plot, <span class="fu">aes</span>(visits, ticket, <span class="at">color =</span> cid),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">8</span>, <span class="at">stroke =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"무작위 초기 중심(★) 표시"</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"하루 평균 방문객 수"</span>, <span class="at">y =</span> <span class="st">"1인당 평균 구매액(원)"</span>) <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="할당-단계는-각-매장을-가장-가까운-중심에-맡기는-일이다" class="level3" data-number="11.2.4">
<h3 data-number="11.2.4" class="anchored" data-anchor-id="할당-단계는-각-매장을-가장-가까운-중심에-맡기는-일이다"><span class="header-section-number">11.2.4</span> 할당 단계는 각 매장을 가장 가까운 중심에 맡기는 일이다</h3>
<p>할당 단계는 모든 매장과 각 중심 사이의 거리를 계산하고, 가장 가까운 중심의 군집 레이블을 붙인다. 여기서의 거리는 표준화 공간에서의 유클리드 거리를 뜻한다. 비즈니스적으로 해석하면 운영 패턴이 가장 흡사한 기준점에 매장을 분류하는 과정이다. 예를 들어 방문객이 많고 객단가가 높으며 체류 시간이 짧은 매장은 도심형 중심점으로 빨려 들어가는 경향을 보인다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 표준화 공간에서의 E-step 구현</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>euclid <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) <span class="fu">sqrt</span>(<span class="fu">sum</span>((a <span class="sc">-</span> b)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>assign_clusters <span class="ot">&lt;-</span> <span class="cf">function</span>(X, C) {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X: n x p, C: K x p</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(X, <span class="dv">1</span>, <span class="cf">function</span>(xi){</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">apply</span>(C, <span class="dv">1</span>, <span class="cf">function</span>(cj) <span class="fu">euclid</span>(xi, cj))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">which.min</span>(d)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">assign_clusters</span>(scaled, centroids_z)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 현재 할당을 원시 변수 공간으로 그려 보기</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>stores<span class="sc">$</span>cluster_tmp <span class="ot">&lt;-</span> <span class="fu">factor</span>(clusters)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stores, <span class="fu">aes</span>(visits, ticket, <span class="at">color =</span> cluster_tmp)) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"E-step: 가장 가까운 중심으로 임시 할당"</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"하루 평균 방문객 수"</span>, <span class="at">y =</span> <span class="st">"1인당 평균 구매액(원)"</span>) <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"임시 군집"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="중심-갱신은-각-군집의-평균을-다시-계산하는-일이다" class="level3" data-number="11.2.5">
<h3 data-number="11.2.5" class="anchored" data-anchor-id="중심-갱신은-각-군집의-평균을-다시-계산하는-일이다"><span class="header-section-number">11.2.5</span> 중심 갱신은 각 군집의 평균을 다시 계산하는 일이다</h3>
<p>중심 갱신은 군집 내부의 모든 매장을 평균내어 새로운 중심을 만드는 과정이다. 도심형 군집에 상대적으로 저가 매장이 많이 들어오면 그 군집의 평균 객단가가 내려가고, 주거형 군집에 체류 시간이 긴 매장이 추가되면 군집 중심의 체류 시간이 더 길어진다. 이 업데이트는 다음 할당 단계에서 경계선을 바꾸는 효과를 낸다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 표준화 공간에서 M-step 구현</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>update_centroids <span class="ot">&lt;-</span> <span class="cf">function</span>(X, z, K){</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  Cnew <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA_real_</span>, <span class="at">nrow =</span> K, <span class="at">ncol =</span> <span class="fu">ncol</span>(X))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K){</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    Cnew[k, ] <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(X[z <span class="sc">==</span> k, , <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  Cnew</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>centroids_z <span class="ot">&lt;-</span> <span class="fu">update_centroids</span>(scaled, clusters, K)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 역표준화 함수</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>inv_scale <span class="ot">&lt;-</span> <span class="cf">function</span>(Z, center, scale) {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">&lt;-</span> <span class="fu">sweep</span>(Z, <span class="dv">2</span>, scale, <span class="st">"*"</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">&lt;-</span> <span class="fu">sweep</span>(Z, <span class="dv">2</span>, center, <span class="st">"+"</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  Z</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 표준화 메타데이터</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>center_vec <span class="ot">&lt;-</span> <span class="fu">attr</span>(scaled, <span class="st">"scaled:center"</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>scale_vec  <span class="ot">&lt;-</span> <span class="fu">attr</span>(scaled, <span class="st">"scaled:scale"</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 표준화 중심(centroids_z)을 원시 스케일로 복원하고 컬럼명 부여</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>centroids_back <span class="ot">&lt;-</span> <span class="fu">inv_scale</span>(centroids_z, center_vec, scale_vec)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>centroids_back <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(centroids_back)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 원래 변수명으로 맞춰 주기 (순서가 동일해야 함)</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(centroids_back) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(stores[, <span class="fu">c</span>(<span class="st">"visits"</span>,<span class="st">"ticket"</span>,<span class="st">"stay"</span>,<span class="st">"satis"</span>)])</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>centroids_back<span class="sc">$</span>cid <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(centroids_back)))</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 시각화</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stores, <span class="fu">aes</span>(visits, ticket, <span class="at">color =</span> cluster_tmp)) <span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> centroids_back, <span class="fu">aes</span>(<span class="at">x =</span> visits, <span class="at">y =</span> ticket),</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">8</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"M-step: 갱신된 중심(★) 표시"</span>,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"하루 평균 방문객 수"</span>, <span class="at">y =</span> <span class="st">"1인당 평균 구매액(원)"</span>) <span class="sc">+</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="반복은-경계가-더-이상-움직이지-않을-때까지-계속된다" class="level3" data-number="11.2.6">
<h3 data-number="11.2.6" class="anchored" data-anchor-id="반복은-경계가-더-이상-움직이지-않을-때까지-계속된다"><span class="header-section-number">11.2.6</span> 반복은 경계가 더 이상 움직이지 않을 때까지 계속된다</h3>
<p>할당과 갱신을 번갈아 수행하면 중심과 군집 배정이 점차 안정된다. 이때 변화량이 0이 되거나 사전에 정한 반복 횟수에 도달하면 절차를 멈춘다. 실무에서는 더 이상 재할당이 없거나 군집 내 제곱합이 충분히 수렴하면 종료한다. 아래 코드는 수렴까지의 과정을 기록하고, 각 반복에서의 군집 내 제곱합 합계가 줄어드는 모습을 확인한다. 줄어드는 속도가 둔화되다가 평평해지면 알고리즘이 멈춘다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>iterate_kmeans <span class="ot">&lt;-</span> <span class="cf">function</span>(X, K, <span class="at">max_iter =</span> <span class="dv">50</span>){</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 초기 중심 무작위</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> X[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(X), K), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  hist <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">iter =</span> <span class="dv">0</span>, <span class="at">wcss =</span> <span class="cn">NA_real_</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">assign_clusters</span>(X, C)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(it <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>max_iter){</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    C <span class="ot">&lt;-</span> <span class="fu">update_centroids</span>(X, z, K)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    z_new <span class="ot">&lt;-</span> <span class="fu">assign_clusters</span>(X, C)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># WCSS 계산</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    wcss <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>K, <span class="cf">function</span>(k){</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(<span class="fu">rowSums</span>((X[z_new <span class="sc">==</span> k, , <span class="at">drop =</span> <span class="cn">FALSE</span>] <span class="sc">-</span> <span class="fu">matrix</span>(C[k, ], <span class="at">nrow =</span> <span class="fu">sum</span>(z_new<span class="sc">==</span>k), <span class="at">ncol =</span> <span class="fu">ncol</span>(X), <span class="at">byrow =</span> <span class="cn">TRUE</span>))<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    hist <span class="ot">&lt;-</span> <span class="fu">rbind</span>(hist, <span class="fu">data.frame</span>(<span class="at">iter =</span> it, <span class="at">wcss =</span> wcss))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">all</span>(z_new <span class="sc">==</span> z)) <span class="cf">break</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">&lt;-</span> z_new</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">cluster =</span> z, <span class="at">centroids =</span> C, <span class="at">history =</span> hist[<span class="sc">-</span><span class="dv">1</span>, ])</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">99</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">iterate_kmeans</span>(scaled, <span class="at">K =</span> <span class="dv">3</span>, <span class="at">max_iter =</span> <span class="dv">30</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>stores<span class="sc">$</span>cluster_final <span class="ot">&lt;-</span> <span class="fu">factor</span>(out<span class="sc">$</span>cluster)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(out<span class="sc">$</span>history, <span class="fu">aes</span>(iter, wcss)) <span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"반복에 따른 군집 내 제곱합(WCSS) 감소"</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"반복 횟수"</span>, <span class="at">y =</span> <span class="st">"WCSS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="종료-조건은-더-이상-바뀌지-않는다는-신호다" class="level3" data-number="11.2.7">
<h3 data-number="11.2.7" class="anchored" data-anchor-id="종료-조건은-더-이상-바뀌지-않는다는-신호다"><span class="header-section-number">11.2.7</span> 종료 조건은 더 이상 바뀌지 않는다는 신호다</h3>
<p>알고리즘은 더 이상 데이터가 다른 군집으로 옮겨 가지 않거나, 중심의 이동량이 미세한 수준으로 떨어지면 멈춘다. 비즈니스 해석에서 이는 매장 유형이 충분히 안정적으로 구분되었음을 의미한다. 수렴 결과를 요약하면 각 군집의 평균 운영 지표와 표본 수가 나온다. 이 표는 도심형, 주거형, 캠퍼스형 같은 레이블을 붙이는 단서가 된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>summary_tbl <span class="ot">&lt;-</span> stores <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_final) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_mean =</span> <span class="fu">mean</span>(visits),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ticket_mean =</span> <span class="fu">mean</span>(ticket),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">stay_mean =</span> <span class="fu">mean</span>(stay),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">satis_mean =</span> <span class="fu">mean</span>(satis),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>summary_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  cluster_final     n visits_mean ticket_mean stay_mean satis_mean
  &lt;fct&gt;         &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 1                77        295.       5208.      15.6       4.00
2 2               103        202.       6475.      27.1       4.38
3 3               120        322.       7154.      17.8       4.09</code></pre>
</div>
</div>
</section>
<section id="em-관점으로-연결하면-머릿속-정리가-빨라진다" class="level3" data-number="11.2.8">
<h3 data-number="11.2.8" class="anchored" data-anchor-id="em-관점으로-연결하면-머릿속-정리가-빨라진다"><span class="header-section-number">11.2.8</span> EM 관점으로 연결하면 머릿속 정리가 빨라진다</h3>
<p>k-평균은 잠재적 소속군을 추정하고 그 소속을 전제로 중심을 다시 계산한다는 점에서 <strong>EM(Expectation–Maximization)</strong>과 구조가 같다. 할당 단계가 E-step에 해당하고, 중심 갱신이 M-step에 해당한다. 확률모형을 쓰는 엄밀한 EM과 달리 k-평균은 하드 할당으로 진행한다는 차이가 있는데, 이 단순함 덕분에 속도가 빠르다. 계산 자원이 제한된 상황에서도 수천 개 매장 데이터를 몇 초 내에 분류할 수 있다는 점이 현장에서는 큰 장점이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 최종 결과 시각화: 방문객-객단가 평면에서 최종 군집</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stores, <span class="fu">aes</span>(visits, ticket, <span class="at">color =</span> cluster_final)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"최종 군집 결과: 방문객 수 vs 객단가"</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"하루 평균 방문객 수"</span>, <span class="at">y =</span> <span class="st">"1인당 평균 구매액(원)"</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"군집"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="결과를-외식-전략으로-번역해야-분석이-힘을-가진다" class="level3" data-number="11.2.9">
<h3 data-number="11.2.9" class="anchored" data-anchor-id="결과를-외식-전략으로-번역해야-분석이-힘을-가진다"><span class="header-section-number">11.2.9</span> 결과를 외식 전략으로 번역해야 분석이 힘을 가진다</h3>
<p>최종 표를 보면 방문객 수가 많고 객단가가 높은 군집은 회전율 중심의 도심형 매장일 가능성이 높다. 이 유형은 피크타임 인력 배치 최적화, 모바일 선주문 유도, 테이크아웃 동선 개선이 성과를 좌우한다. 방문객 수는 중간이지만 체류 시간이 길고 만족도가 높은 군집은 주거형 라운지형 매장으로 읽힌다. 이 유형은 좌석 회전보다 충성 고객 유지가 중요하므로 멤버십 적립 강화와 커뮤니티 이벤트가 어울린다. 방문객이 많지만 객단가가 낮은 군집은 캠퍼스형 테이크아웃 매장으로 해석되며, 번들 메뉴와 시간대별 딜이 효과적이다. 같은 데이터라도 K를 다르게 주면 전략의 결이 달라지니, K 결정은 단순한 기술 선택이 아니라 전략의 경계를 긋는 작업이라는 점을 항상 기억해야 한다.</p>
</section>
</section>
<section id="주요-알고리즘" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="주요-알고리즘"><span class="header-section-number">11.3</span> 주요 알고리즘</h2>
<section id="외식산업-시나리오" class="level3" data-number="11.3.1">
<h3 data-number="11.3.1" class="anchored" data-anchor-id="외식산업-시나리오"><span class="header-section-number">11.3.1</span> 외식산업 시나리오</h3>
<p>전국에 200개 매장을 보유한 패밀리 레스토랑 본사가 있다고 가정하자. 매장별 하루 평균 방문객 수, 1인당 평균 구매액, 고객 만족도, 평균 체류 시간을 분석하여 매장을 유형별로 나누고자 한다. 군집화 방식에 따라 결과가 달라질 수 있는데, 이는 초기 중심 선택과 중심 갱신 방식, 거리 계산 방식 등 알고리즘 변형에 기인한다. 여기서는 k-평균의 네 가지 주요 변형인 <strong>Lloyd</strong>, <strong>Forgy</strong>, <strong>MacQueen</strong>, <strong>Hartigan–Wong</strong>을 외식산업 데이터로 비교한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 생성</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 가상의 매장 데이터 생성</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">70</span>  <span class="co"># 도심형</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">70</span>  <span class="co"># 주거형</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>n3 <span class="ot">&lt;-</span> <span class="dv">60</span>  <span class="co"># 관광지형</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>cluster1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="dv">350</span>, <span class="at">sd =</span> <span class="dv">25</span>),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="dv">8500</span>, <span class="at">sd =</span> <span class="dv">400</span>),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">stay   =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">2</span>),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">satis  =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="fl">4.2</span>, <span class="at">sd =</span> <span class="fl">0.3</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>cluster2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="dv">220</span>, <span class="at">sd =</span> <span class="dv">20</span>),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="dv">7500</span>, <span class="at">sd =</span> <span class="dv">300</span>),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">stay   =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="dv">30</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">satis  =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="fl">4.4</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>cluster3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="dv">280</span>, <span class="at">sd =</span> <span class="dv">30</span>),</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="dv">6200</span>, <span class="at">sd =</span> <span class="dv">350</span>),</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">stay   =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="dv">18</span>, <span class="at">sd =</span> <span class="fl">2.5</span>),</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">satis  =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="fl">4.0</span>, <span class="at">sd =</span> <span class="fl">0.3</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>stores <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cluster1, cluster2, cluster3)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>stores_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(stores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lloyd-알고리즘" class="level3" data-number="11.3.2">
<h3 data-number="11.3.2" class="anchored" data-anchor-id="lloyd-알고리즘"><span class="header-section-number">11.3.2</span> Lloyd 알고리즘</h3>
<p>Lloyd 방식은 <strong>가장 보편적</strong>인 k-평균 구현이다. 중심과 각 데이터의 거리를 반복 계산하며 군집을 갱신하고, <strong>데이터는 연속형이라는 가정</strong>을 깔고 있다. 모든 데이터가 중심 갱신 단계가 끝날 때까지 기다린 뒤 한꺼번에 할당이 바뀐다. 외식 매장 데이터에서는 첫 반복 이후 중심이 크게 이동하고, 반복이 거듭될수록 군집 경계가 안정된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>lloyd_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">1</span>, <span class="at">algorithm =</span> <span class="st">"Lloyd"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stores<span class="sc">$</span>visits, stores<span class="sc">$</span>ticket, <span class="at">col =</span> lloyd_result<span class="sc">$</span>cluster,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Lloyd 알고리즘 결과"</span>, <span class="at">xlab =</span> <span class="st">"방문객 수"</span>, <span class="at">ylab =</span> <span class="st">"객단가(원)"</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(lloyd_result<span class="sc">$</span>centers[,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:scale"</span>)[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:center"</span>)[<span class="dv">1</span>],</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>       lloyd_result<span class="sc">$</span>centers[,<span class="dv">2</span>]<span class="sc">*</span><span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:scale"</span>)[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:center"</span>)[<span class="dv">2</span>],</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">8</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="forgy-알고리즘" class="level3" data-number="11.3.3">
<h3 data-number="11.3.3" class="anchored" data-anchor-id="forgy-알고리즘"><span class="header-section-number">11.3.3</span> Forgy 알고리즘</h3>
<p>Forgy 방식은 <strong>초기 중심을 실제 데이터 포인트에서 무작위로 선택</strong>한다. 이 방법은 <strong>데이터가 불연속적이거나 카테고리형일 때에도 응용</strong>할 수 있다. 초기 중심이 극단값을 포함하면 결과가 왜곡될 수 있지만, 반복 실행으로 안정성을 확보할 수 있다. 외식 데이터에서는 초기 선택에 따라 첫 군집 경계가 달라져, 도심형 매장 일부가 관광지형 군집에 묶이는 일이 생기기도 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>forgy_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> stores_scaled[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stores_scaled), <span class="dv">3</span>),], </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nstart =</span> <span class="dv">1</span>, <span class="at">algorithm =</span> <span class="st">"Lloyd"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stores<span class="sc">$</span>visits, stores<span class="sc">$</span>ticket, <span class="at">col =</span> forgy_result<span class="sc">$</span>cluster,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Forgy 알고리즘 결과"</span>, <span class="at">xlab =</span> <span class="st">"방문객 수"</span>, <span class="at">ylab =</span> <span class="st">"객단가(원)"</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(forgy_result<span class="sc">$</span>centers[,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:scale"</span>)[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:center"</span>)[<span class="dv">1</span>],</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>       forgy_result<span class="sc">$</span>centers[,<span class="dv">2</span>]<span class="sc">*</span><span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:scale"</span>)[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:center"</span>)[<span class="dv">2</span>],</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">8</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="macqueen-방법" class="level3" data-number="11.3.4">
<h3 data-number="11.3.4" class="anchored" data-anchor-id="macqueen-방법"><span class="header-section-number">11.3.4</span> MacQueen 방법</h3>
<p>MacQueen 방식은 새로운 샘플이 군집에 할당될 때마다 즉시 중심을 갱신한다. 한 번의 할당 후 군집 평균이 바로 바뀌기 때문에 <strong>데이터 순서에 민감</strong>하다. 외식 매장 데이터에 적용하면, 데이터 순서가 도심형→관광지형→주거형으로 들어왔을 때와 그 반대 순서로 들어왔을 때 결과가 달라질 수 있다. 이는 신속한 실시간 업데이트가 필요할 때 유용하지만, <strong>재현성 측면에서는 주의가 필요하다.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MacQueen 알고리즘은 기본 kmeans()에서 algorithm="MacQueen"으로 가능</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>macqueen_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">1</span>, <span class="at">algorithm =</span> <span class="st">"MacQueen"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stores<span class="sc">$</span>visits, stores<span class="sc">$</span>ticket, <span class="at">col =</span> macqueen_result<span class="sc">$</span>cluster,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"MacQueen 알고리즘 결과"</span>, <span class="at">xlab =</span> <span class="st">"방문객 수"</span>, <span class="at">ylab =</span> <span class="st">"객단가(원)"</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(macqueen_result<span class="sc">$</span>centers[,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:scale"</span>)[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:center"</span>)[<span class="dv">1</span>],</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>       macqueen_result<span class="sc">$</span>centers[,<span class="dv">2</span>]<span class="sc">*</span><span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:scale"</span>)[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:center"</span>)[<span class="dv">2</span>],</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">8</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="hartiganwong-방법" class="level3" data-number="11.3.5">
<h3 data-number="11.3.5" class="anchored" data-anchor-id="hartiganwong-방법"><span class="header-section-number">11.3.5</span> Hartigan–Wong 방법</h3>
<p>Hartigan–Wong 방식은 k-평균 구현 중에서도 <strong>가장 널리 쓰인다. </strong>각 데이터가 다른 군집으로 이동했을 때 군집 내 제곱합(WCSS)이 줄어드는지를 평가해, <strong>WCSS 감소가 최대가 되는 방향으로 재배치</strong>한다. 이는 군집 간 경계를 미세하게 조정해, 특히 경계 근처에 위치한 매장의 할당을 최적화한다. 외식 매장 데이터에서는 경계 지역 매장들이 더 타당한 군집으로 이동하며, 도심과 관광지의 경계 매장이 자연스럽게 갈린다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>hartigan_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">1</span>, <span class="at">algorithm =</span> <span class="st">"Hartigan-Wong"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stores<span class="sc">$</span>visits, stores<span class="sc">$</span>ticket, <span class="at">col =</span> hartigan_result<span class="sc">$</span>cluster,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Hartigan–Wong 알고리즘 결과"</span>, <span class="at">xlab =</span> <span class="st">"방문객 수"</span>, <span class="at">ylab =</span> <span class="st">"객단가(원)"</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(hartigan_result<span class="sc">$</span>centers[,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:scale"</span>)[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:center"</span>)[<span class="dv">1</span>],</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>       hartigan_result<span class="sc">$</span>centers[,<span class="dv">2</span>]<span class="sc">*</span><span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:scale"</span>)[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">attr</span>(stores_scaled,<span class="st">"scaled:center"</span>)[<span class="dv">2</span>],</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">8</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="알고리즘-비교" class="level3" data-number="11.3.6">
<h3 data-number="11.3.6" class="anchored" data-anchor-id="알고리즘-비교"><span class="header-section-number">11.3.6</span> 알고리즘 비교</h3>
<p>네 가지 방법 모두 동일한 데이터에 K=3을 적용했지만, 초기 중심 선택과 갱신 방식 차이로 군집 경계와 군집 내 일관성이 다르게 나타날 수 있다. 아래 표는 각 알고리즘이 어떤 상황에서 강점을 가지는지를 요약한 것이다.</p>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 20%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>알고리즘</th>
<th>특징</th>
<th>장점</th>
<th>주의점</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lloyd</td>
<td>중심-거리 반복, 연속형 데이터</td>
<td>안정적, 재현성 높음</td>
<td>초기 중심에 민감</td>
</tr>
<tr class="even">
<td>Forgy</td>
<td>무작위 초기 중심</td>
<td>간단, 다양한 데이터에 적용</td>
<td>초기 극단값 위험</td>
</tr>
<tr class="odd">
<td>MacQueen</td>
<td>실시간 중심 갱신</td>
<td>빠른 업데이트, 온라인 적용 가능</td>
<td>데이터 순서에 민감</td>
</tr>
<tr class="even">
<td>Hartigan–Wong</td>
<td>WCSS 최소화</td>
<td>최적화된 경계, 일반적 권장</td>
<td>계산 조금 더 복잡</td>
</tr>
</tbody>
</table>
<p>외식산업에서는 실시간으로 신규 매장이 추가되는 경우 MacQueen 방식이, 정기적인 전략 수립에는 Hartigan–Wong이나 Lloyd 방식이 적합하다. Forgy 방식은 초기 데이터가 균형 잡혀 있고 빠른 탐색이 필요할 때 가볍게 사용할 수 있다.</p>
</section>
</section>
<section id="k-값-결정-방법" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="k-값-결정-방법"><span class="header-section-number">11.4</span> K 값 결정 방법</h2>
<section id="왜-k-값을-결정해야-하는가" class="level3" data-number="11.4.1">
<h3 data-number="11.4.1" class="anchored" data-anchor-id="왜-k-값을-결정해야-하는가"><span class="header-section-number">11.4.1</span> 왜 K 값을 결정해야 하는가?</h3>
<p>k-평균 군집분석에서 가장 중요한 초기 설정 중 하나는 <strong>군집 개수 K</strong>를 정하는 일이다. K를 너무 작게 잡으면 서로 다른 특성을 가진 매장들이 한 군집에 섞여 버리고, 너무 크게 잡으면 비슷한 매장들이 불필요하게 쪼개져 분석 효율이 떨어진다. 전국 300개 외식 매장을 대상으로 매출, 방문객 수, 객단가, 체류 시간을 분석할 때, K=2로 설정하면 단순히 ’잘 나가는 매장’과 ’그렇지 않은 매장’만 구분될 수 있지만, K=6으로 설정하면 지나치게 세분화되어 군집별 전략 수립이 어려워질 수 있다. 적절한 K를 찾는 것은 분석 결과의 해석 가능성과 비즈니스 활용도를 좌우하는 핵심 단계다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">101</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 가상의 외식 매장 데이터 생성</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>n3 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>cluster1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="dv">350</span>, <span class="at">sd =</span> <span class="dv">25</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="dv">8200</span>, <span class="at">sd =</span> <span class="dv">350</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">stay   =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">2</span>),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">satis  =</span> <span class="fu">rnorm</span>(n1, <span class="at">mean =</span> <span class="fl">4.2</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>cluster2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="dv">240</span>, <span class="at">sd =</span> <span class="dv">20</span>),</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="dv">7200</span>, <span class="at">sd =</span> <span class="dv">300</span>),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">stay   =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="dv">28</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">satis  =</span> <span class="fu">rnorm</span>(n2, <span class="at">mean =</span> <span class="fl">4.3</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>cluster3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="dv">300</span>, <span class="at">sd =</span> <span class="dv">30</span>),</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="dv">5800</span>, <span class="at">sd =</span> <span class="dv">400</span>),</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">stay   =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="dv">18</span>, <span class="at">sd =</span> <span class="fl">2.5</span>),</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">satis  =</span> <span class="fu">rnorm</span>(n3, <span class="at">mean =</span> <span class="fl">4.0</span>, <span class="at">sd =</span> <span class="fl">0.3</span>)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>stores <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cluster1, cluster2, cluster3)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>stores_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(stores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="덴드로그램을-이용한-방법" class="level3" data-number="11.4.2">
<h3 data-number="11.4.2" class="anchored" data-anchor-id="덴드로그램을-이용한-방법"><span class="header-section-number">11.4.2</span> 덴드로그램을 이용한 방법</h3>
<p>덴드로그램은 계층적 군집분석 결과를 나무 구조로 시각화한 그래프다. 데이터 간의 유사성을 기준으로 병합 과정을 단계별로 보여주며, 나무를 자르는 높이에 따라 군집 개수를 결정할 수 있다. 예를 들어, 높이를 3으로 자르면 도심형, 주거형, 관광형 매장 세 그룹이 생기고, 높이를 더 낮게 자르면 각 그룹이 더 세분화된다. 덴드로그램은 군집 구조를 직관적으로 이해하는 데 유용하지만, 데이터가 많으면 시각적으로 복잡해지고 연산 시간이 길어질 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 거리행렬 계산 후 계층적 군집</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>dist_mat <span class="ot">&lt;-</span> <span class="fu">dist</span>(stores_scaled, <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_mat, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 덴드로그램 시각화</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">labels =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">"외식 매장 덴드로그램"</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">sub =</span> <span class="st">""</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">15</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)  <span class="co"># 예시로 높이 8에서 자르기</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="팔꿈치-방법" class="level3" data-number="11.4.3">
<h3 data-number="11.4.3" class="anchored" data-anchor-id="팔꿈치-방법"><span class="header-section-number">11.4.3</span> 팔꿈치 방법</h3>
<p>팔꿈치 방법은 K를 1부터 일정 범위까지 변화시키며 각 K 값에서의 <strong>군집 내 제곱합(WCSS)</strong>을 계산하고, 이를 그래프로 그린다. K가 커질수록 WCSS는 줄어들지만, 어느 순간부터 감소 폭이 줄어드는 지점이 나타난다. 이 꺾이는 지점이 팔꿈치처럼 보여 ’팔꿈치 방법’이라고 부른다. 외식 매장 데이터에서 이 방법을 사용하면, K=3에서 급격한 감소 이후 완만해지며, 이는 세 개의 유형으로 구분하는 것이 합리적일 수 있음을 시사한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>wcss <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">20</span>)<span class="sc">$</span>tot.withinss</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>elbow_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">K =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">WCSS =</span> wcss)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elbow_df, <span class="fu">aes</span>(K, WCSS)) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"팔꿈치 방법에 의한 K 결정"</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"군집 개수 K"</span>, <span class="at">y =</span> <span class="st">"군집 내 제곱합(WCSS)"</span>) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">3</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="실루엣-계수-방법" class="level3" data-number="11.4.4">
<h3 data-number="11.4.4" class="anchored" data-anchor-id="실루엣-계수-방법"><span class="header-section-number">11.4.4</span> 실루엣 계수 방법</h3>
<p>실루엣 계수는 각 데이터 포인트가 속한 군집 내부의 <strong>응집도</strong>와 다른 군집과의 <strong>분리도</strong>를 함께 고려한 지표다. 값은 -1에서 1 사이이며, <strong>1에 가까울수록 해당 데이터가 군집에 잘 맞는다는 의미</strong>다. <strong>평균 실루엣 계수가 최대가 되는 K를 선택</strong>하는 것이 일반적이다. 외식 매장 데이터에서 계산해 보면, K=3일 때 평균 실루엣 계수가 가장 높게 나와, 매장을 세 그룹으로 나누는 것이 데이터 구조에 잘 맞음을 알 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>sil_width <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>, <span class="cf">function</span>(k) {</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  ss <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(km<span class="sc">$</span>cluster, <span class="fu">dist</span>(stores_scaled))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(ss[, <span class="dv">3</span>])</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>sil_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">K =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">Silhouette =</span> sil_width)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sil_df, <span class="fu">aes</span>(K, Silhouette)) <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"실루엣 계수에 의한 K 결정"</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"군집 개수 K"</span>, <span class="at">y =</span> <span class="st">"평균 실루엣 계수"</span>) <span class="sc">+</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">3</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="방법-비교와-해석" class="level3" data-number="11.4.5">
<h3 data-number="11.4.5" class="anchored" data-anchor-id="방법-비교와-해석"><span class="header-section-number">11.4.5</span> 방법 비교와 해석</h3>
<p>덴드로그램, 팔꿈치, 실루엣 계수는 서로 다른 관점에서 K를 제시한다. 덴드로그램은 시각적 해석에 강점이 있고, 팔꿈치는 변화율을 수치로 잡아내며, 실루엣은 군집 품질을 평가한다. 세 방법이 모두 K=3을 지지한다면, 도심형, 주거형, 관광형 매장이라는 세 가지 전략 집단을 도출할 수 있다. 이렇게 결정된 K는 이후 마케팅 전략, 메뉴 구성, 매장 운영 방식 차별화 등 구체적 실행 계획으로 연결될 수 있다.</p>
</section>
</section>
<section id="k-평균-군집분석의-특징과-유의점" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="k-평균-군집분석의-특징과-유의점"><span class="header-section-number">11.5</span> K-평균 군집분석의 특징과 유의점</h2>
<section id="계산-속도와-확장성" class="level3" data-number="11.5.1">
<h3 data-number="11.5.1" class="anchored" data-anchor-id="계산-속도와-확장성"><span class="header-section-number">11.5.1</span> 계산 속도와 확장성</h3>
<p>k-평균 군집분석의 가장 큰 장점 중 하나는 <strong>계산 속도가 빠르다</strong>는 점이다. 중심-거리 계산과 평균 갱신이라는 단순한 연산 구조 덕분에 수천, 수만 건의 데이터도 짧은 시간 안에 처리할 수 있다. 예를 들어, 전국 5,000개 외식 매장의 매출, 방문객 수, 체류 시간, 만족도 데이터를 한 번에 분석해도 몇 초 내에 결과를 얻을 수 있다. 다른 복잡한 군집 알고리즘에 비해 CPU 자원 사용량이 적어 대규모 데이터셋을 다룰 때 유리하다. 실제 본사가 분기마다 모든 매장을 군집화해 전략 그룹을 재정의하는 상황에서는 빠른 연산 속도가 곧 분석 주기 단축과 직결된다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">202</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 5000개 매장 가상 데이터 생성</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>stores <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">visits =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">250</span>, <span class="at">sd =</span> <span class="dv">40</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">7500</span>, <span class="at">sd =</span> <span class="dv">500</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">stay   =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">25</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">satis  =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="fl">4.2</span>, <span class="at">sd =</span> <span class="fl">0.3</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>stores_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(stores)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
   0.21    0.00    0.22 </code></pre>
</div>
</div>
</section>
<section id="구현의-단순함" class="level3" data-number="11.5.2">
<h3 data-number="11.5.2" class="anchored" data-anchor-id="구현의-단순함"><span class="header-section-number">11.5.2</span> 구현의 단순함</h3>
<p>k-평균은 수학적으로나 구현 측면에서 단순하다. 중심과 각 데이터 간 거리를 계산하고, 가장 가까운 중심으로 재할당하며, 새로운 중심을 계산하는 과정을 반복하는 것이 전부다. 이 구조 덕분에 R, Python, Excel 등 대부분의 분석 도구에서 기본 기능으로 제공되며, 실무 현장에서 빠르게 적용할 수 있다. 외식 본사에서는 매월 갱신되는 매출 데이터를 그대로 가져와 몇 줄의 코드만으로 군집 분석을 실행하고 결과를 리포트에 바로 반영할 수 있다.</p>
</section>
<section id="k-값-결정과-초기-중심의-영향" class="level3" data-number="11.5.3">
<h3 data-number="11.5.3" class="anchored" data-anchor-id="k-값-결정과-초기-중심의-영향"><span class="header-section-number">11.5.3</span> K 값 결정과 초기 중심의 영향</h3>
<p>단순함에도 불구하고 k-평균은 K 값과 초기 중심 설정에 매우 민감하다. K를 너무 작게 잡으면 서로 다른 성격의 매장이 같은 그룹에 묶이고, 너무 크게 잡으면 비슷한 매장이 인위적으로 쪼개진다. 초기 중심이 극단값에 위치하면 알고리즘이 지역해(local optimum)에 빠져 실제 구조를 반영하지 못할 수 있다. 예를 들어, 도심형 매장과 관광지형 매장을 섞어 분석할 때 초기 중심이 관광지형에만 몰리면, 도심형 매장이 잘못 분류될 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">303</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>sample_stores <span class="ot">&lt;-</span> stores_scaled[<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, ]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>km_bad_init <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(sample_stores, <span class="at">centers =</span> sample_stores[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, ], <span class="at">nstart =</span> <span class="dv">1</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>km_good_init <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(sample_stores, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>km_bad_init<span class="sc">$</span>tot.withinss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 49.48532</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>km_good_init<span class="sc">$</span>tot.withinss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 47.46074</code></pre>
</div>
</div>
<p>위 예시처럼 초기 중심 선택에 따라 군집 내 제곱합(WCSS) 값이 크게 달라질 수 있다. 이는 결과 해석의 신뢰성에도 직접적인 영향을 준다.</p>
</section>
<section id="아웃라이어의-영향" class="level3" data-number="11.5.4">
<h3 data-number="11.5.4" class="anchored" data-anchor-id="아웃라이어의-영향"><span class="header-section-number">11.5.4</span> 아웃라이어의 영향</h3>
<p>k-평균은 중심에서의 거리로 군집을 정의하기 때문에 아웃라이어에 민감하다. 한두 개의 극단적인 데이터가 중심을 끌어당겨 군집 경계를 왜곡할 수 있다. 외식 매장에서 극단적인 매출 기록이 있는 매장, 예를 들어 이벤트로 하루 매출이 평소의 10배가 된 매장이 분석에 포함되면 해당 군집의 중심이 실제보다 높게 설정될 수 있다. 이 경우 해당 군집의 전략이 왜곡될 가능성이 높다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 아웃라이어 추가</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>stores_outlier <span class="ot">&lt;-</span> stores</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>stores_outlier[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">20000</span>, <span class="dv">40</span>, <span class="fl">5.0</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>km_no_outlier <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(<span class="fu">scale</span>(stores), <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>km_with_outlier <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(<span class="fu">scale</span>(stores_outlier), <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>km_no_outlier<span class="sc">$</span>centers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       visits     ticket       stay       satis
1 -0.81354688  0.9375051  0.1624630 -0.09645859
2  0.77201181  0.2246697 -0.5277016 -0.69773426
3  0.03406656 -0.7237305  0.9880005 -0.16211300
4 -0.06428269 -0.3927263 -0.5575966  0.94128234</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>km_with_outlier<span class="sc">$</span>centers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      visits      ticket       stay      satis
1  0.2719850  0.15539534 -0.9067677  0.6348726
2 -0.4984422  0.18727433 -0.3058737 -1.0292683
3  0.9655296 -0.29322094  0.5557191 -0.2850905
4 -0.7410412 -0.06751718  0.7361803  0.6512782</code></pre>
</div>
</div>
<p>결과를 비교하면 아웃라이어가 포함된 경우 일부 군집의 평균이 크게 변한 것을 확인할 수 있다. 따라서 <strong>k-평균 적용 전에는 반드시 이상값을 탐지하고 처리</strong>해야 한다.</p>
</section>
<section id="군집-크기와-모양의-제약" class="level3" data-number="11.5.5">
<h3 data-number="11.5.5" class="anchored" data-anchor-id="군집-크기와-모양의-제약"><span class="header-section-number">11.5.5</span> 군집 크기와 모양의 제약</h3>
<p>k-평균은 모든 군집이 구형(spherical)이고 크기가 비슷하다는 가정을 전제로 한다. 군집 모양이 길쭉하거나 크기 차이가 크면 결과가 왜곡된다. 예를 들어, 도심형 매장은 매출이 높고 방문객 수가 많아 데이터 분포가 길게 늘어져 있을 수 있고, 외곽형 매장은 크기가 작아 데이터가 한 점에 몰려 있을 수 있다. 이런 경우 k-평균은 경계선을 잘못 긋게 된다.</p>
</section>
<section id="표준화의-필요성" class="level3" data-number="11.5.6">
<h3 data-number="11.5.6" class="anchored" data-anchor-id="표준화의-필요성"><span class="header-section-number">11.5.6</span> 표준화의 필요성</h3>
<p>변수 단위나 범위가 다르면 거리 계산이 왜곡될 수 있다. 방문객 수(단위: 명)와 객단가(단위: 원)를 함께 쓰면, 값의 크기가 큰 변수(객단가)가 거리 계산에서 훨씬 큰 영향을 미친다. 이를 방지하려면 <strong>표준화(Z-score normalization)</strong>가 필수적이다. 표준화는 각 변수에서 평균을 빼고 표준편차로 나누어 평균이 0, 표준편차가 1이 되도록 변환하는 과정이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 표준화 전후 거리 계산 비교</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>dist_raw <span class="ot">&lt;-</span> <span class="fu">dist</span>(stores[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">c</span>(<span class="st">"visits"</span>, <span class="st">"ticket"</span>)])</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>dist_scaled <span class="ot">&lt;-</span> <span class="fu">dist</span>(<span class="fu">scale</span>(stores[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">c</span>(<span class="st">"visits"</span>, <span class="st">"ticket"</span>)]))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(dist_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1        2        3         4         5
1    0.0000 1947.221 968.0313  272.5388  486.3561
2 1947.2208    0.000 979.5250 1674.8027 1462.3168
3  968.0313  979.525   0.0000  695.5076  482.8133
4  272.5388 1674.803 695.5076    0.0000  214.2969
5  486.3561 1462.317 482.8133  214.2969    0.0000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(dist_scaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1        2         3         4         5
1 0.0000000 3.074639 2.3529062 0.7944581 2.5391681
2 3.0746388 0.000000 1.3067148 2.4130316 2.0480673
3 2.3529062 1.306715 0.0000000 1.5647846 0.7898489
4 0.7944581 2.413032 1.5647846 0.0000000 1.7705010
5 2.5391681 2.048067 0.7898489 1.7705010 0.0000000</code></pre>
</div>
</div>
<p>표준화 전에는 객단가 차이가 거리를 지배하지만, 표준화 후에는 두 변수의 영향력이 균형을 이루게 된다.</p>
</section>
<section id="종합적-해석" class="level3" data-number="11.5.7">
<h3 data-number="11.5.7" class="anchored" data-anchor-id="종합적-해석"><span class="header-section-number">11.5.7</span> 종합적 해석</h3>
<p>k-평균은 빠르고 구현이 쉬우며 대규모 데이터를 효율적으로 처리할 수 있는 장점이 있지만, K 값 결정, 초기 중심, 아웃라이어, 군집 모양과 크기 제약, 표준화 문제를 고려하지 않으면 결과가 왜곡될 수 있다. 분석 결과는 반드시 비즈니스 관점에서 해석해야 하며, 군집별 특성이 전략 실행에 어떤 의미를 가지는지 구체적으로 연결하는 것이 중요하다. 예를 들어, 군집 분석 결과가 단순히 세 그룹으로 나뉘었다는 사실보다, 각 그룹에 어떤 운영 패턴과 매출 구조가 있는지를 분석해 매뉴얼, 마케팅, 메뉴 구성에 반영하는 것이 실질적인 가치다.</p>
</section>
</section>
<section id="k-평균-군집분석-실습" class="level2" data-number="11.6">
<h2 data-number="11.6" class="anchored" data-anchor-id="k-평균-군집분석-실습"><span class="header-section-number">11.6</span> k-평균 군집분석 실습</h2>
<section id="실습-시나리오" class="level3" data-number="11.6.1">
<h3 data-number="11.6.1" class="anchored" data-anchor-id="실습-시나리오"><span class="header-section-number">11.6.1</span> 실습 시나리오</h3>
<p>한 외식 프랜차이즈 기업이 전국 800개 이상의 매장에서 수집한 데이터를 바탕으로 고객 유형을 세분화하려고 한다. 데이터에는 고객의 <strong>구매금액</strong>, <strong>방문빈도</strong>, <strong>만족도</strong>가 기록되어 있다.</p>
</section>
<section id="실습-데이터" class="level3" data-number="11.6.2">
<h3 data-number="11.6.2" class="anchored" data-anchor-id="실습-데이터"><span class="header-section-number">11.6.2</span> 실습 데이터</h3>
<p><a href="data/ch11_data1.csv">실습 데이터</a></p>
</section>
<section id="분석-절차" class="level3" data-number="11.6.3">
<h3 data-number="11.6.3" class="anchored" data-anchor-id="분석-절차"><span class="header-section-number">11.6.3</span> 분석 절차</h3>
<p>분석은 다음과 같은 흐름으로 진행된다.</p>
<p><strong>첫째,</strong> 데이터를 불러오고 결측값이 있는지 확인하며 필요시 결측값 처리와 이상값 점검을 한다. <br> <strong>둘째,</strong> 변수를 표준화하여 변수 간 단위 차이로 인한 거리 왜곡을 방지한다. <br> <strong>셋째,</strong> 팔꿈치 방법과 실루엣 계수를 활용하여 적절한 K 값을 결정한다. <br> <strong>넷째,</strong> K-평균 군집분석을 적용하여 결과를 도출하고 군집별 평균값과 특성을 비교한다. <br> <strong>마지막으로,</strong> 결과를 시각화하여 군집 간 차이를 직관적으로 확인하고, 각 군집의 특성에 맞춘 마케팅 전략을 제시한다. <br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 불러오기</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>stores <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/ch11_data1.csv"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 전처리: 표준화</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>stores_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(stores)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 팔꿈치 방법</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>wcss <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k) {</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">20</span>)<span class="sc">$</span>tot.withinss</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>elbow_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">K =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">WCSS =</span> wcss)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elbow_df, <span class="fu">aes</span>(K, WCSS)) <span class="sc">+</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"팔꿈치 방법"</span>, <span class="at">x =</span> <span class="st">"K 값"</span>, <span class="at">y =</span> <span class="st">"WCSS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 실루엣 계수</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>sil_width <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>, <span class="cf">function</span>(k) {</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  ss <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(km<span class="sc">$</span>cluster, <span class="fu">dist</span>(stores_scaled))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(ss[, <span class="dv">3</span>])</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>sil_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">K =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">Silhouette =</span> sil_width)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sil_df, <span class="fu">aes</span>(K, Silhouette)) <span class="sc">+</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"실루엣 계수"</span>, <span class="at">x =</span> <span class="st">"K 값"</span>, <span class="at">y =</span> <span class="st">"평균 실루엣 계수"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="k-평균-적용과-결과-비교" class="level3" data-number="11.6.4">
<h3 data-number="11.6.4" class="anchored" data-anchor-id="k-평균-적용과-결과-비교"><span class="header-section-number">11.6.4</span> K-평균 적용과 결과 비교</h3>
<p>팔꿈치 방법과 실루엣 계수를 종합하여 최적의 K 값을 결정한 뒤, K-평균 군집분석을 수행한다. 이후 각 군집의 평균 구매금액, 방문빈도, 만족도를 비교하고 시각화한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 예시: K=2 적용</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>final_k <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>km_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> final_k, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>stores<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(km_result<span class="sc">$</span>cluster)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집별 평균 비교</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>stores <span class="sc">%&gt;%</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(purchase, visits, satisfaction), mean), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  cluster purchase visits satisfaction
  &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;
1 1         33188.   16.0         4.27
2 2         61949.   22.9         3.83</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 시각화</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stores, <span class="fu">aes</span>(purchase, visits, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"K-평균 군집 결과"</span>, <span class="at">x =</span> <span class="st">"구매금액"</span>, <span class="at">y =</span> <span class="st">"방문빈도"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 예시: K=3 적용</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>final_k <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>km_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> final_k, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>stores<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(km_result<span class="sc">$</span>cluster)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집별 평균 비교</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>stores <span class="sc">%&gt;%</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(purchase, visits, satisfaction), mean), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  cluster purchase visits satisfaction
  &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;
1 1         68923.   25.2         3.66
2 2         30100.   15.1         4.29
3 3         53392.   20.5         4.04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 시각화</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stores, <span class="fu">aes</span>(purchase, visits, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"K-평균 군집 결과"</span>, <span class="at">x =</span> <span class="st">"구매금액"</span>, <span class="at">y =</span> <span class="st">"방문빈도"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 예시: K=6 적용</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>final_k <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>km_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(stores_scaled, <span class="at">centers =</span> final_k, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>stores<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(km_result<span class="sc">$</span>cluster)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집별 평균 비교</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>stores <span class="sc">%&gt;%</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(purchase, visits, satisfaction), mean), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  cluster purchase visits satisfaction
  &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;
1 1         30244.   13.0         4.32
2 2         57660.   20.2         4.24
3 3         48797.   19.8         3.77
4 4         69588.   25.5         3.97
5 5         30725.   18.5         4.22
6 6         70047.   25.1         3.40</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 시각화</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stores, <span class="fu">aes</span>(purchase, visits, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"K-평균 군집 결과"</span>, <span class="at">x =</span> <span class="st">"구매금액"</span>, <span class="at">y =</span> <span class="st">"방문빈도"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter11_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="결과-해석과-전략-제시" class="level3" data-number="11.6.5">
<h3 data-number="11.6.5" class="anchored" data-anchor-id="결과-해석과-전략-제시"><span class="header-section-number">11.6.5</span> 결과 해석과 전략 제시</h3>
<p>위의 기본분석 내용을 기반으로 본인만의 분석을 다시 실시하고 그 결과를 바탕으로 전략을 제시하시오.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter10.html" class="pagination-link  aria-label=" &lt;span="" 군집분석&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">계층적 군집분석</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>