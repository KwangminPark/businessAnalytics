<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.531">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>비즈니스 애널리틱스 (Business Analytics) - 10&nbsp; 계층적 군집분석</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter11.html" rel="next">
<link href="./Chapter9.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter10.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">계층적 군집분석</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">비즈니스 애널리틱스 (Business Analytics)</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">오리엔테이션</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">통계학의 본질과 변수의 이해</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">기술통계와 요약</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">일원배치 분산분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">이원배치 분산분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">회귀분석: 통계의 꽃</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">조절효과와 매개효과</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">차원축소와 주성분 분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">요인분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter10.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">계층적 군집분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">k-평균 군집분석</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#계층적-군집분석이란-무엇인가" id="toc-계층적-군집분석이란-무엇인가" class="nav-link active" data-scroll-target="#계층적-군집분석이란-무엇인가"><span class="header-section-number">10.1</span> 계층적 군집분석이란 무엇인가?</a>
  <ul class="collapse">
  <li><a href="#데이터-속에-숨어-있는-자연스러운-그룹을-찾는-방법" id="toc-데이터-속에-숨어-있는-자연스러운-그룹을-찾는-방법" class="nav-link" data-scroll-target="#데이터-속에-숨어-있는-자연스러운-그룹을-찾는-방법"><span class="header-section-number">10.1.1</span> 데이터 속에 숨어 있는 ’자연스러운 그룹’을 찾는 방법</a></li>
  <li><a href="#지도학습이-아닌-정답-없는-데이터로부터-시작하는-분석" id="toc-지도학습이-아닌-정답-없는-데이터로부터-시작하는-분석" class="nav-link" data-scroll-target="#지도학습이-아닌-정답-없는-데이터로부터-시작하는-분석"><span class="header-section-number">10.1.2</span> 지도학습이 아닌, 정답 없는 데이터로부터 시작하는 분석</a></li>
  <li><a href="#군집분석의-핵심-원리-동질성과-이질성" id="toc-군집분석의-핵심-원리-동질성과-이질성" class="nav-link" data-scroll-target="#군집분석의-핵심-원리-동질성과-이질성"><span class="header-section-number">10.1.3</span> 군집분석의 핵심 원리: 동질성과 이질성</a></li>
  <li><a href="#계층적-군집분석의-정의와-핵심-개념" id="toc-계층적-군집분석의-정의와-핵심-개념" class="nav-link" data-scroll-target="#계층적-군집분석의-정의와-핵심-개념"><span class="header-section-number">10.1.4</span> 계층적 군집분석의 정의와 핵심 개념</a></li>
  <li><a href="#외식산업-사례-전국-프랜차이즈-매장의-자연스러운-군집" id="toc-외식산업-사례-전국-프랜차이즈-매장의-자연스러운-군집" class="nav-link" data-scroll-target="#외식산업-사례-전국-프랜차이즈-매장의-자연스러운-군집"><span class="header-section-number">10.1.5</span> 외식산업 사례: 전국 프랜차이즈 매장의 자연스러운 군집</a></li>
  <li><a href="#덴드로그램으로-시각화된-의사결정" id="toc-덴드로그램으로-시각화된-의사결정" class="nav-link" data-scroll-target="#덴드로그램으로-시각화된-의사결정"><span class="header-section-number">10.1.6</span> 덴드로그램으로 시각화된 의사결정</a></li>
  <li><a href="#계층적-군집분석의-장점과-주의사항" id="toc-계층적-군집분석의-장점과-주의사항" class="nav-link" data-scroll-target="#계층적-군집분석의-장점과-주의사항"><span class="header-section-number">10.1.7</span> 계층적 군집분석의 장점과 주의사항</a></li>
  </ul></li>
  <li><a href="#계층적-군집-형성-방법" id="toc-계층적-군집-형성-방법" class="nav-link" data-scroll-target="#계층적-군집-형성-방법"><span class="header-section-number">10.2</span> 계층적 군집 형성 방법</a>
  <ul class="collapse">
  <li><a href="#군집을-어떻게-묶을-것인가-두-가지-방식의-출발점" id="toc-군집을-어떻게-묶을-것인가-두-가지-방식의-출발점" class="nav-link" data-scroll-target="#군집을-어떻게-묶을-것인가-두-가지-방식의-출발점"><span class="header-section-number">10.2.1</span> 군집을 어떻게 묶을 것인가?: 두 가지 방식의 출발점</a></li>
  <li><a href="#외식산업-예제-전국-매장을-묶는-두-가지-방법의-차이" id="toc-외식산업-예제-전국-매장을-묶는-두-가지-방법의-차이" class="nav-link" data-scroll-target="#외식산업-예제-전국-매장을-묶는-두-가지-방법의-차이"><span class="header-section-number">10.2.2</span> 외식산업 예제: 전국 매장을 묶는 두 가지 방법의 차이</a></li>
  <li><a href="#시각적으로-이해해보기-군집이-형성되는-흐름" id="toc-시각적으로-이해해보기-군집이-형성되는-흐름" class="nav-link" data-scroll-target="#시각적으로-이해해보기-군집이-형성되는-흐름"><span class="header-section-number">10.2.3</span> 시각적으로 이해해보기: 군집이 형성되는 흐름</a></li>
  <li><a href="#분석-방법의-선택-현실과-실용성의-균형" id="toc-분석-방법의-선택-현실과-실용성의-균형" class="nav-link" data-scroll-target="#분석-방법의-선택-현실과-실용성의-균형"><span class="header-section-number">10.2.4</span> 분석 방법의 선택: 현실과 실용성의 균형</a></li>
  </ul></li>
  <li><a href="#계층적-군집분석-계산-단계" id="toc-계층적-군집분석-계산-단계" class="nav-link" data-scroll-target="#계층적-군집분석-계산-단계"><span class="header-section-number">10.3</span> 계층적 군집분석 계산 단계</a>
  <ul class="collapse">
  <li><a href="#군집은-어떻게-형성되는가-계산-단계로-보는-흐름" id="toc-군집은-어떻게-형성되는가-계산-단계로-보는-흐름" class="nav-link" data-scroll-target="#군집은-어떻게-형성되는가-계산-단계로-보는-흐름"><span class="header-section-number">10.3.1</span> 군집은 어떻게 형성되는가?: 계산 단계로 보는 흐름</a></li>
  <li><a href="#step-1-거리-행렬-계산" id="toc-step-1-거리-행렬-계산" class="nav-link" data-scroll-target="#step-1-거리-행렬-계산"><span class="header-section-number">10.3.2</span> Step 1: 거리 행렬 계산</a></li>
  <li><a href="#step-2-가장-가까운-군집-병합" id="toc-step-2-가장-가까운-군집-병합" class="nav-link" data-scroll-target="#step-2-가장-가까운-군집-병합"><span class="header-section-number">10.3.3</span> Step 2: 가장 가까운 군집 병합</a></li>
  <li><a href="#step-3-거리-행렬-업데이트" id="toc-step-3-거리-행렬-업데이트" class="nav-link" data-scroll-target="#step-3-거리-행렬-업데이트"><span class="header-section-number">10.3.4</span> Step 3: 거리 행렬 업데이트</a></li>
  <li><a href="#step-4-반복-수행" id="toc-step-4-반복-수행" class="nav-link" data-scroll-target="#step-4-반복-수행"><span class="header-section-number">10.3.5</span> Step 4: 반복 수행</a></li>
  <li><a href="#실제-군집-병합-순서-정리" id="toc-실제-군집-병합-순서-정리" class="nav-link" data-scroll-target="#실제-군집-병합-순서-정리"><span class="header-section-number">10.3.6</span> 실제 군집 병합 순서 정리</a></li>
  <li><a href="#시각적-해석-덴드로그램에서-군집-수-결정" id="toc-시각적-해석-덴드로그램에서-군집-수-결정" class="nav-link" data-scroll-target="#시각적-해석-덴드로그램에서-군집-수-결정"><span class="header-section-number">10.3.7</span> 시각적 해석: 덴드로그램에서 군집 수 결정</a></li>
  <li><a href="#분석-요약" id="toc-분석-요약" class="nav-link" data-scroll-target="#분석-요약"><span class="header-section-number">10.3.8</span> 분석 요약</a></li>
  </ul></li>
  <li><a href="#거리-측정-방법의-선택" id="toc-거리-측정-방법의-선택" class="nav-link" data-scroll-target="#거리-측정-방법의-선택"><span class="header-section-number">10.4</span> 거리 측정 방법의 선택</a>
  <ul class="collapse">
  <li><a href="#왜-거리가-분석-결과를-바꾸는가" id="toc-왜-거리가-분석-결과를-바꾸는가" class="nav-link" data-scroll-target="#왜-거리가-분석-결과를-바꾸는가"><span class="header-section-number">10.4.1</span> 왜 ’거리’가 분석 결과를 바꾸는가</a></li>
  <li><a href="#연속형-변수일-때-사용할-수-있는-거리-측정-방법" id="toc-연속형-변수일-때-사용할-수-있는-거리-측정-방법" class="nav-link" data-scroll-target="#연속형-변수일-때-사용할-수-있는-거리-측정-방법"><span class="header-section-number">10.4.2</span> 연속형 변수일 때 사용할 수 있는 거리 측정 방법</a></li>
  <li><a href="#연속형변수-거리-측정법의-예제" id="toc-연속형변수-거리-측정법의-예제" class="nav-link" data-scroll-target="#연속형변수-거리-측정법의-예제"><span class="header-section-number">10.4.3</span> 연속형변수 거리 측정법의 예제</a></li>
  <li><a href="#표준화-거리-standardized-euclidean-distance" id="toc-표준화-거리-standardized-euclidean-distance" class="nav-link" data-scroll-target="#표준화-거리-standardized-euclidean-distance"><span class="header-section-number">10.4.4</span> 표준화 거리 (Standardized Euclidean Distance)</a></li>
  <li><a href="#명목형-변수에서는-유사도-계수를-사용한다" id="toc-명목형-변수에서는-유사도-계수를-사용한다" class="nav-link" data-scroll-target="#명목형-변수에서는-유사도-계수를-사용한다"><span class="header-section-number">10.4.5</span> 명목형 변수에서는 유사도 계수를 사용한다</a></li>
  <li><a href="#연속형과-명목형이-섞이면-어떻게-할까" id="toc-연속형과-명목형이-섞이면-어떻게-할까" class="nav-link" data-scroll-target="#연속형과-명목형이-섞이면-어떻게-할까"><span class="header-section-number">10.4.6</span> 연속형과 명목형이 섞이면 어떻게 할까?</a></li>
  <li><a href="#실무-팁-변수-선택이-거리보다-더-중요할-수-있다" id="toc-실무-팁-변수-선택이-거리보다-더-중요할-수-있다" class="nav-link" data-scroll-target="#실무-팁-변수-선택이-거리보다-더-중요할-수-있다"><span class="header-section-number">10.4.7</span> 실무 팁: 변수 선택이 거리보다 더 중요할 수 있다</a></li>
  </ul></li>
  <li><a href="#군집분석-알고리즘의-핵심" id="toc-군집분석-알고리즘의-핵심" class="nav-link" data-scroll-target="#군집분석-알고리즘의-핵심"><span class="header-section-number">10.5</span> 군집분석 알고리즘의 핵심</a>
  <ul class="collapse">
  <li><a href="#군집-간-거리-계산의-의미" id="toc-군집-간-거리-계산의-의미" class="nav-link" data-scroll-target="#군집-간-거리-계산의-의미"><span class="header-section-number">10.5.1</span> 군집 간 거리 계산의 의미</a></li>
  <li><a href="#시각적-예-군집-간-거리-계산-방식" id="toc-시각적-예-군집-간-거리-계산-방식" class="nav-link" data-scroll-target="#시각적-예-군집-간-거리-계산-방식"><span class="header-section-number">10.5.2</span> 시각적 예: 군집 간 거리 계산 방식</a></li>
  <li><a href="#단일-연결법-single-linkage" id="toc-단일-연결법-single-linkage" class="nav-link" data-scroll-target="#단일-연결법-single-linkage"><span class="header-section-number">10.5.3</span> 단일 연결법 (Single Linkage)</a></li>
  <li><a href="#완전-연결법-complete-linkage" id="toc-완전-연결법-complete-linkage" class="nav-link" data-scroll-target="#완전-연결법-complete-linkage"><span class="header-section-number">10.5.4</span> 완전 연결법 (Complete Linkage)</a></li>
  <li><a href="#평균-연결법-average-linkage" id="toc-평균-연결법-average-linkage" class="nav-link" data-scroll-target="#평균-연결법-average-linkage"><span class="header-section-number">10.5.5</span> 평균 연결법 (Average Linkage)</a></li>
  <li><a href="#중심-연결법-centroid-method" id="toc-중심-연결법-centroid-method" class="nav-link" data-scroll-target="#중심-연결법-centroid-method"><span class="header-section-number">10.5.6</span> 중심 연결법 (Centroid Method)</a></li>
  <li><a href="#ward-연결법-wards-method" id="toc-ward-연결법-wards-method" class="nav-link" data-scroll-target="#ward-연결법-wards-method"><span class="header-section-number">10.5.7</span> Ward 연결법 (Ward’s Method)</a></li>
  <li><a href="#알고리즘-비교-요약표" id="toc-알고리즘-비교-요약표" class="nav-link" data-scroll-target="#알고리즘-비교-요약표"><span class="header-section-number">10.5.8</span> 알고리즘 비교 요약표</a></li>
  <li><a href="#다양한-알고리즘-시각화-비교" id="toc-다양한-알고리즘-시각화-비교" class="nav-link" data-scroll-target="#다양한-알고리즘-시각화-비교"><span class="header-section-number">10.5.9</span> 다양한 알고리즘 시각화 비교</a></li>
  <li><a href="#결론-알고리즘-선택은-전략의-출발점" id="toc-결론-알고리즘-선택은-전략의-출발점" class="nav-link" data-scroll-target="#결론-알고리즘-선택은-전략의-출발점"><span class="header-section-number">10.5.10</span> 결론: 알고리즘 선택은 전략의 출발점</a></li>
  </ul></li>
  <li><a href="#계층적-군집분석-실습-프랜차이즈-매장-고객-군집" id="toc-계층적-군집분석-실습-프랜차이즈-매장-고객-군집" class="nav-link" data-scroll-target="#계층적-군집분석-실습-프랜차이즈-매장-고객-군집"><span class="header-section-number">10.6</span> 계층적 군집분석 실습: 프랜차이즈 매장 고객 군집</a>
  <ul class="collapse">
  <li><a href="#분석에-사용된-변수" id="toc-분석에-사용된-변수" class="nav-link" data-scroll-target="#분석에-사용된-변수"><span class="header-section-number">10.6.1</span> 분석에 사용된 변수</a></li>
  <li><a href="#분석-데이터-생성-및-구조-확인" id="toc-분석-데이터-생성-및-구조-확인" class="nav-link" data-scroll-target="#분석-데이터-생성-및-구조-확인"><span class="header-section-number">10.6.2</span> 분석 데이터 생성 및 구조 확인</a></li>
  <li><a href="#거리-측정-및-군집-알고리즘-적용" id="toc-거리-측정-및-군집-알고리즘-적용" class="nav-link" data-scroll-target="#거리-측정-및-군집-알고리즘-적용"><span class="header-section-number">10.6.3</span> 거리 측정 및 군집 알고리즘 적용</a></li>
  <li><a href="#알고리즘별-덴드로그램-시각화" id="toc-알고리즘별-덴드로그램-시각화" class="nav-link" data-scroll-target="#알고리즘별-덴드로그램-시각화"><span class="header-section-number">10.6.4</span> 알고리즘별 덴드로그램 시각화</a></li>
  <li><a href="#ward-방법에-기반한-군집-결과-해석" id="toc-ward-방법에-기반한-군집-결과-해석" class="nav-link" data-scroll-target="#ward-방법에-기반한-군집-결과-해석"><span class="header-section-number">10.6.5</span> Ward 방법에 기반한 군집 결과 해석</a></li>
  <li><a href="#군집-해석-및-인사이트-도출" id="toc-군집-해석-및-인사이트-도출" class="nav-link" data-scroll-target="#군집-해석-및-인사이트-도출"><span class="header-section-number">10.6.6</span> 군집 해석 및 인사이트 도출</a></li>
  <li><a href="#실습을-통해-얻은-결론" id="toc-실습을-통해-얻은-결론" class="nav-link" data-scroll-target="#실습을-통해-얻은-결론"><span class="header-section-number">10.6.7</span> 실습을 통해 얻은 결론</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">계층적 군집분석</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="계층적-군집분석이란-무엇인가" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="계층적-군집분석이란-무엇인가"><span class="header-section-number">10.1</span> 계층적 군집분석이란 무엇인가?</h2>
<section id="데이터-속에-숨어-있는-자연스러운-그룹을-찾는-방법" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1" class="anchored" data-anchor-id="데이터-속에-숨어-있는-자연스러운-그룹을-찾는-방법"><span class="header-section-number">10.1.1</span> 데이터 속에 숨어 있는 ’자연스러운 그룹’을 찾는 방법</h3>
<p>일반적으로 인간은 그룹을 나누길 좋아한다. 좀 더 명확하게 표현하자면, 현상에서 보이는 내용을 유사한 그룹끼리 묶어서 이해하는 것을 보다 선호한다. 이는 한편으로는 사회적 진화와 생존의 과정에서 나타나는 자연스러운 현상일 수 있다. 예를 들어, 수렵과 채집을 하던 시기에, 인간에게 가장 중요한 능력중의 하나는 인간 이외의 짐승들에 대해서 인간에게 위협적인 짐승과 인간에게 도움이 되는 짐승을 구분하는 것이었을 것이다. 또한, 인간이 먹을 수 있는 과일이나 곡물과 먹으면 안되는 것을 구분하는 것이 매우 중요한 능력이었을 것이다. 이와 같이, 데이터 속에 숨어 있는 자연스러운 그러나 매우 중요한 유사점과 차이점을 가진 그룹을 구분하는 것을 군집분석이라고 한다.</p>
<p>외식 프랜차이즈 본사에서 전국의 가맹점을 분석할 때, 모든 매장이 동일하게 운영된다고 가정하는 것은 현실과 다르다. 어떤 매장은 점심시간에 몰리는 직장인을 중심으로 운영되고, 또 어떤 매장은 저녁 시간대 가족 단위 고객이 주를 이룬다. 이러한 서로 다른 특성을 반영하지 않고 전국 매장을 동일한 전략으로 관리한다면, 성과는 저조할 수밖에 없다. 이처럼 <strong>속성이 유사한 집단을 자연스럽게 구분</strong>하려는 것이 바로 <strong>군집분석(clustering)</strong>의 핵심 목적이다.</p>
</section>
<section id="지도학습이-아닌-정답-없는-데이터로부터-시작하는-분석" class="level3" data-number="10.1.2">
<h3 data-number="10.1.2" class="anchored" data-anchor-id="지도학습이-아닌-정답-없는-데이터로부터-시작하는-분석"><span class="header-section-number">10.1.2</span> 지도학습이 아닌, 정답 없는 데이터로부터 시작하는 분석</h3>
<p>군집분석은 <strong>비지도학습(Unsupervised Learning)</strong>에 해당한다. 이는 정답(라벨)이 주어지지 않은 데이터를 분석하는 방식이다. 예를 들어 고객 데이터에 ‘충성고객’ 또는 ’이탈예정 고객’이라는 라벨이 없다면, 분류분석을 수행할 수 없다. 이럴 때, 고객들의 행동 패턴을 기준으로 비슷한 성향의 고객을 그룹화하는 것이 군집분석이다. 관측값들 사이의 <strong>유사성(similarity)</strong> 또는 <strong>거리(distance)</strong> 를 기준으로 한다.</p>
</section>
<section id="군집분석의-핵심-원리-동질성과-이질성" class="level3" data-number="10.1.3">
<h3 data-number="10.1.3" class="anchored" data-anchor-id="군집분석의-핵심-원리-동질성과-이질성"><span class="header-section-number">10.1.3</span> 군집분석의 핵심 원리: 동질성과 이질성</h3>
<p>군집분석에서 가장 중요한 원리는 <strong>군집 내 동질성(homogeneity)</strong>과 <strong>군집 간 이질성(heterogeneity)</strong>이다. 같은 군집에 속한 관측값들은 서로 유사해야 하며, 다른 군집에 속한 값들과는 뚜렷하게 달라야 한다. 예를 들어, 한 프랜차이즈 본사의 고객 데이터에서 ‘직장인 점심 고객’, ‘주말 가족 단위 고객’, ’배달 전문 고객’이 뚜렷이 나뉜다면, 그 세 그룹은 서로 이질적인 특성을 보이지만, 각 군집 내에서는 매우 유사한 소비 패턴을 갖는다는 의미이다.</p>
</section>
<section id="계층적-군집분석의-정의와-핵심-개념" class="level3" data-number="10.1.4">
<h3 data-number="10.1.4" class="anchored" data-anchor-id="계층적-군집분석의-정의와-핵심-개념"><span class="header-section-number">10.1.4</span> 계층적 군집분석의 정의와 핵심 개념</h3>
<p>계층적 군집분석(Hierarchical Clustering)은 이름 그대로 데이터를 트리(tree) 구조로 연결하여 점차적으로 군집을 형성해가는 방식이다. <strong>사전에 군집의 개수를 정할 필요 없이</strong>, 모든 관측값을 하나의 군집이 될 때까지(또는 하나의 군집이 남을 때까지) 군집을 통합하거나 분할하면서 분석이 진행된다.</p>
<p>이 방식은 특히 <strong>고객 세분화(Segmentation)</strong>, <strong>지점 분류(Franchise Classification)</strong>, <strong>신제품 타겟 분석</strong> 등 외식산업에서 자주 활용된다. 분석 결과는 트리 형태로 표현되며, 이를 <strong>덴드로그램(Dendrogram)</strong>이라고 부른다. 덴드로그램을 통해 어느 시점에서 군집을 자르는 것이 가장 합리적인지 시각적으로 판단할 수 있다.</p>
</section>
<section id="외식산업-사례-전국-프랜차이즈-매장의-자연스러운-군집" class="level3" data-number="10.1.5">
<h3 data-number="10.1.5" class="anchored" data-anchor-id="외식산업-사례-전국-프랜차이즈-매장의-자연스러운-군집"><span class="header-section-number">10.1.5</span> 외식산업 사례: 전국 프랜차이즈 매장의 자연스러운 군집</h3>
<p>한 외식 브랜드 본사에서는 다음과 같은 세 가지 변수로 전국 150개 매장을 분석하고자 한다:</p>
<p><strong>-</strong> 하루 평균 객단가(원) <br> <strong>-</strong> 하루 평균 방문 고객 수 <br> <strong>-</strong> 주말 고객 비율(%) <br></p>
<p>이 데이터를 계층적 군집분석으로 분석하면 다음과 같이 자연스러운 그룹이 나타날 수 있다:</p>
<p><strong>- Group A</strong>: 고객 수는 적지만, 객단가가 매우 높은 고급 상권 매장 <br> <strong>- Group B</strong>: 고객 수가 많고, 객단가도 중간 이상인 대학가 중심 매장 <br> <strong>- Group C</strong>: 배달 비중이 높고 주말 매출이 높은 주택가 기반 매장 <br></p>
<p>이러한 분석 결과를 기반으로, Group A는 고급 디저트 메뉴 강화, Group B는 회전율 관리, Group C는 배달 할인 정책 적용 등 <strong>차별화된 전략 수립이 가능하다</strong>.</p>
</section>
<section id="덴드로그램으로-시각화된-의사결정" class="level3" data-number="10.1.6">
<h3 data-number="10.1.6" class="anchored" data-anchor-id="덴드로그램으로-시각화된-의사결정"><span class="header-section-number">10.1.6</span> 덴드로그램으로 시각화된 의사결정</h3>
<p>계층적 군집분석은 분석 결과가 <strong>덴드로그램 형태로 시각화</strong>된다는 장점이 있다. 예를 들어, 위의 전국 매장 데이터를 분석한 후 덴드로그램을 그리면, 어느 시점에서 군집을 3개로 나누는 것이 가장 자연스러운지 눈으로 확인할 수 있다. 이는 연구자 또는 실무자가 직관적으로 군집을 평가하고 전략을 수립하는 데 큰 도움을 준다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 예시 R 코드: 계층적 군집분석</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">12000</span>, <span class="dv">15000</span>, <span class="dv">13000</span>, <span class="dv">8000</span>, <span class="dv">8500</span>, <span class="dv">7000</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">customers =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">95</span>, <span class="dv">250</span>, <span class="dv">300</span>, <span class="dv">270</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weekend_ratio =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.25</span>, <span class="fl">0.22</span>, <span class="fl">0.5</span>, <span class="fl">0.55</span>, <span class="fl">0.6</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(data)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>dist_matrix <span class="ot">&lt;-</span> <span class="fu">dist</span>(scaled)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">main =</span> <span class="st">"외식 프랜차이즈 매장 군집분석 덴드로그램"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rect.hclust</span>(hc, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">border =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="계층적-군집분석의-장점과-주의사항" class="level3" data-number="10.1.7">
<h3 data-number="10.1.7" class="anchored" data-anchor-id="계층적-군집분석의-장점과-주의사항"><span class="header-section-number">10.1.7</span> 계층적 군집분석의 장점과 주의사항</h3>
<p>계층적 군집분석은 사전에 군집 개수를 알 필요가 없고, 분석 흐름을 시각적으로 확인할 수 있으며, 변수 표준화만 잘 이루어지면 해석이 용이하다는 장점이 있다. 그러나 한 번 잘못된 군집으로 묶이면 되돌릴 수 없으며, <strong>거리 정의 방식</strong>과 <strong>알고리즘 설정</strong>에 따라 결과가 매우 달라질 수 있다는 점에서 주의가 필요하다.</p>
<p>계층적 군집분석은 <strong>비지도 학습 기반의 분석기법</strong>으로, 외식산업 데이터를 고객, 지점, 제품 유형 등으로 분류할 때 유용하다. 덴드로그램을 통해 결과를 시각적으로 표현할 수 있으며, 분석 전 변수 표준화와 거리측정 방식에 대한 이해가 필요하다. 특히 외식 매장의 특성을 반영한 변수 설계와 실무 맥락 해석이 병행될 때 가장 큰 가치를 발휘한다.</p>
</section>
</section>
<section id="계층적-군집-형성-방법" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="계층적-군집-형성-방법"><span class="header-section-number">10.2</span> 계층적 군집 형성 방법</h2>
<section id="군집을-어떻게-묶을-것인가-두-가지-방식의-출발점" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="군집을-어떻게-묶을-것인가-두-가지-방식의-출발점"><span class="header-section-number">10.2.1</span> 군집을 어떻게 묶을 것인가?: 두 가지 방식의 출발점</h3>
<p>계층적 군집분석은 데이터를 군집으로 나누는 방식에 따라 두 가지 유형으로 나뉜다. 첫 번째 방식은 <strong>합병적 방법(Agglomerative Method)</strong>이고, 두 번째는 <strong>분할적 방법(Divisive Method)</strong>이다. 이 둘은 출발점에서 정반대 방향으로 진행된다. 전자는 개별 데이터를 점차 묶어가고, 후자는 전체 데이터를 점차 나눠간다.</p>
<p>합병적 방법은 각 관측값(매장, 고객 등)을 하나의 군집으로 간주하고 시작한다. 이후 가장 유사한 두 군집을 찾아서 병합하고, 병합 후 다시 전체 군집 간 거리 계산을 반복하면서 하나의 군집이 남을 때까지 계속 결합해간다. 반대로 분할적 방법은 전체 데이터를 하나의 군집으로 시작하여, 유사성이 낮은 관측값부터 점차 분리해나간다. 하지만 실제 분석에서는 <strong>합병적 방법이 훨씬 더 널리 사용</strong>되며, 대부분의 통계 소프트웨어도 이를 기본값으로 제공한다.</p>
</section>
<section id="외식산업-예제-전국-매장을-묶는-두-가지-방법의-차이" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="외식산업-예제-전국-매장을-묶는-두-가지-방법의-차이"><span class="header-section-number">10.2.2</span> 외식산업 예제: 전국 매장을 묶는 두 가지 방법의 차이</h3>
<p>한 프랜차이즈 본사가 전국의 100개 가맹점을 고객 행동 특성으로 군집화하려 한다고 가정해보자. 사용된 변수는 다음과 같다.</p>
<p><strong>-</strong> 주간 평균 객단가 <br> <strong>-</strong> 주말 고객 비중 <br> <strong>-</strong> 배달 비율 <br></p>
<p>합병적 방법은 100개 매장을 각각 하나의 군집으로 시작한다. 그리고 유사도가 가장 높은 두 매장을 묶는다. 예를 들어, 강남점과 서초점이 비슷한 매출 패턴을 보인다면 이 둘이 가장 먼저 병합된다. 그 후 이 새로운 군집과 다른 매장 간의 거리를 다시 계산하여 병합을 계속한다. 이 과정을 반복하면, 최종적으로 전체 매장이 하나의 군집으로 병합된다. 분석자는 중간 단계에서 적절한 군집 수를 덴드로그램에서 자르고 판단하게 된다.</p>
<p>분할적 방법은 반대로, 100개 매장을 하나의 큰 군집으로 시작한다. 그 다음 가장 이질적인 매장을 찾아서 두 개의 그룹으로 나누고, 각 그룹 내에서 다시 분할을 반복한다. 이 방법은 이론적으로도 가능하지만 실제 데이터 수가 많을 경우 계산량이 급증하고, 결과가 불안정해지는 경우가 많다. 특히 외식산업처럼 변수 간 상관관계가 복잡하고 외부 요인의 영향(상권, 날씨 등)이 큰 경우에는 <strong>합병적 방식이 훨씬 안정적이고 직관적</strong>이다.</p>
</section>
<section id="시각적으로-이해해보기-군집이-형성되는-흐름" class="level3" data-number="10.2.3">
<h3 data-number="10.2.3" class="anchored" data-anchor-id="시각적으로-이해해보기-군집이-형성되는-흐름"><span class="header-section-number">10.2.3</span> 시각적으로 이해해보기: 군집이 형성되는 흐름</h3>
<p>계층적 군집 형성은 시각화가 핵심이다. 덴드로그램을 활용하면 군집 형성과정을 트리 구조로 볼 수 있다. 아래 R 코드는 합병적 방법을 활용하여 6개 매장을 기준으로 군집을 형성하는 흐름을 보여준다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 계층적 군집 형성 예시 (Agglomerative 방식)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">12000</span>, <span class="dv">15000</span>, <span class="dv">13000</span>, <span class="dv">8000</span>, <span class="dv">8500</span>, <span class="dv">7000</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">customers =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">95</span>, <span class="dv">250</span>, <span class="dv">300</span>, <span class="dv">270</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">delivery_ratio =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.12</span>, <span class="fl">0.5</span>, <span class="fl">0.55</span>, <span class="fl">0.6</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(data)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>dist_matrix <span class="ot">&lt;-</span> <span class="fu">dist</span>(scaled)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">main =</span> <span class="st">"합병적 계층적 군집분석 덴드로그램"</span>, <span class="at">xlab =</span> <span class="st">"매장"</span>, <span class="at">sub =</span> <span class="st">""</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rect.hclust</span>(hc, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">border =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>이 결과는 분석자가 덴드로그램을 직접 해석하면서 적절한 군집 수를 결정할 수 있게 한다. 실제 분석에서는 고객 특성, 상권 환경, 경쟁 매장 수 등 외부 요인을 고려하여 군집의 수를 정한다.</p>
</section>
<section id="분석-방법의-선택-현실과-실용성의-균형" class="level3" data-number="10.2.4">
<h3 data-number="10.2.4" class="anchored" data-anchor-id="분석-방법의-선택-현실과-실용성의-균형"><span class="header-section-number">10.2.4</span> 분석 방법의 선택: 현실과 실용성의 균형</h3>
<p>계층적 군집 형성 방식은 이론적으로는 다양하지만, 실제 데이터 분석 현장에서는 <strong>합병적 방법이 사실상 표준</strong>으로 자리 잡고 있다. 그 이유는 다음과 같다. 첫째, 대부분의 통계 프로그램(SPSS, R, Python 등)은 합병적 방법을 기본으로 제공한다. 둘째, 초기 군집 수를 정할 필요가 없으며, 덴드로그램을 통해 시각적으로 설명하기 쉽다. 셋째, 외식 산업처럼 군집 간 경계가 모호하고 이질성이 중첩되는 경우에 더 유연하게 대응할 수 있다.</p>
<p>분할적 방법은 고도로 이론적인 상황에서는 의미가 있지만, 외식 데이터를 다룰 때는 실제 구현이 까다롭고 계산량이 많다는 한계가 있다. 예를 들어 서울 전체 가맹점 300개를 하나의 군집으로 시작해 하나씩 쪼개나가는 구조는, 중간 분할이 잘못되면 전체 결과가 왜곡될 수 있다.</p>
<p>계층적 군집 형성 방법은 데이터를 병합해가며 군집을 형성하는 방식과, 분할해가며 군집을 구성하는 방식 두 가지로 나뉜다. 실제 분석에서는 계산의 효율성과 결과 해석의 용이성 측면에서 합병적 방법이 일반적으로 선호된다. 특히 외식산업처럼 관측값의 수가 많고 특성의 다양성이 큰 분야에서는 덴드로그램 기반의 시각적 해석과 병합 순서의 직관성이 큰 장점으로 작용한다.</p>
</section>
</section>
<section id="계층적-군집분석-계산-단계" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="계층적-군집분석-계산-단계"><span class="header-section-number">10.3</span> 계층적 군집분석 계산 단계</h2>
<section id="군집은-어떻게-형성되는가-계산-단계로-보는-흐름" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="군집은-어떻게-형성되는가-계산-단계로-보는-흐름"><span class="header-section-number">10.3.1</span> 군집은 어떻게 형성되는가?: 계산 단계로 보는 흐름</h3>
<p>계층적 군집분석은 <strong>데이터 간의 거리</strong> 또는 <strong>유사성</strong>을 기반으로 전체 군집 구조를 단계적으로 만들어 나가는 과정이다. 이때 핵심은 관측값 간 거리 행렬을 바탕으로 가장 가까운 군집을 반복적으로 병합해 가는 것이다. 이 계산 흐름은 단순하지만 반복적이며, 그 과정 전체가 덴드로그램에 담기게 된다. 이 장에서는 <strong>군집이 만들어지는 과정을 수치적으로 이해하는 것</strong>이 목표다.</p>
</section>
<section id="step-1-거리-행렬-계산" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="step-1-거리-행렬-계산"><span class="header-section-number">10.3.2</span> Step 1: 거리 행렬 계산</h3>
<p>분석의 첫 번째 단계는 각 관측값들 간의 거리를 계산하는 것이다. 외식산업에서는 예를 들어 6개 매장을 객단가, 고객 수, 배달 비율 등의 변수로 표현했을 때, 이들 매장 간의 거리를 계산하여 <strong>6x6 거리 행렬(distance matrix)</strong>을 생성한다. 거리는 일반적으로 <strong>유클리드 거리(Euclidean distance)</strong>를 사용하며, 표준화를 선행하는 것이 일반적이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 외식 매장 6곳의 데이터</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">12000</span>, <span class="dv">15000</span>, <span class="dv">13000</span>, <span class="dv">8000</span>, <span class="dv">8500</span>, <span class="dv">7000</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">customers =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">95</span>, <span class="dv">250</span>, <span class="dv">300</span>, <span class="dv">270</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">delivery_ratio =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.12</span>, <span class="fl">0.5</span>, <span class="fl">0.55</span>, <span class="fl">0.6</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 변수 표준화 후 거리 계산</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(data)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  price customers delivery_ratio
1 12000       100           0.10
2 15000        90           0.15
3 13000        95           0.12
4  8000       250           0.50
5  8500       300           0.55
6  7000       270           0.60</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(scaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          price  customers delivery_ratio
[1,]  0.4426723 -0.8500310     -1.0012919
[2,]  1.3800960 -0.9510248     -0.7897514
[3,]  0.7551469 -0.9005279     -0.9166757
[4,] -0.8072260  0.6648758      0.6910325
[5,] -0.6509887  1.1698447      0.9025730
[6,] -1.1197005  0.8668633      1.1141136
attr(,"scaled:center")
         price      customers delivery_ratio 
  1.058333e+04   1.841667e+02   3.366667e-01 
attr(,"scaled:scale")
         price      customers delivery_ratio 
  3200.2604061     99.0159920      0.2363613 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dist_matrix <span class="ot">&lt;-</span> <span class="fu">dist</span>(scaled, <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(dist_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1         2         3         4         5         6
1 0.0000000 0.9662879 0.3276434 2.5925181 2.9834031 3.1406489
2 0.9662879 0.0000000 0.6397040 3.0964872 3.3893000 3.6302069
3 0.3276434 0.6397040 0.0000000 2.7342683 3.0940792 3.2806752
4 2.5925181 3.0964872 2.7342683 0.0000000 0.5693445 0.5634154
5 2.9834031 3.3893000 3.0940792 0.5693445 0.0000000 0.5968567
6 3.1406489 3.6302069 3.2806752 0.5634154 0.5968567 0.0000000</code></pre>
</div>
</div>
<p>출력되는 거리 행렬은 각 매장 쌍 간의 거리 값을 나타내며, 이 행렬을 기반으로 다음 단계로 넘어간다.</p>
</section>
<section id="step-2-가장-가까운-군집-병합" class="level3" data-number="10.3.3">
<h3 data-number="10.3.3" class="anchored" data-anchor-id="step-2-가장-가까운-군집-병합"><span class="header-section-number">10.3.3</span> Step 2: 가장 가까운 군집 병합</h3>
<p>거리 행렬을 통해 현재 군집들(처음에는 각각의 관측값이 하나의 군집임) 중 가장 거리가 가까운 두 개의 군집을 병합한다. 예를 들어 위의 매장 데이터에서 매장4와 매장5가 서로 가장 유사한 소비 패턴을 가지고 있다면 이 둘이 먼저 병합된다.</p>
<p>군집의 수는 처음에는 n개(n = 관측값 수)에서 시작해서, 병합할 때마다 하나씩 줄어든다. 따라서 n-1번의 병합을 거치면 하나의 군집이 남는다.</p>
</section>
<section id="step-3-거리-행렬-업데이트" class="level3" data-number="10.3.4">
<h3 data-number="10.3.4" class="anchored" data-anchor-id="step-3-거리-행렬-업데이트"><span class="header-section-number">10.3.4</span> Step 3: 거리 행렬 업데이트</h3>
<p>새롭게 병합된 군집은 또 하나의 군집으로 간주된다. 이때 기존의 거리 행렬을 새롭게 갱신해야 한다. 어떤 방법으로 업데이트할지는 <strong>선택한 연결법(linkage method)</strong>에 따라 달라진다. 이 교재에서는 대표적으로 Complete Linkage, Average Linkage, Ward’s Method 등을 후속장에서 설명한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 병합 및 덴드로그램 생성 (Ward 방법 사용)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">main =</span> <span class="st">"계층적 군집 형성 과정"</span>, <span class="at">xlab =</span> <span class="st">"매장"</span>, <span class="at">sub =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-4-반복-수행" class="level3" data-number="10.3.5">
<h3 data-number="10.3.5" class="anchored" data-anchor-id="step-4-반복-수행"><span class="header-section-number">10.3.5</span> Step 4: 반복 수행</h3>
<p>이번에는 데이터를 바탕으로 <strong>거리 행렬</strong>에서 어떤 순서로 군집이 형성되었는지 확인하고, 그 과정을 정리한다. 먼저 제공된 거리 행렬을 다시 정리하면 다음과 같다.</p>
<table class="table-striped table-hover table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">0.97</td>
<td style="text-align: center;">0.33</td>
<td style="text-align: center;">2.59</td>
<td style="text-align: center;">2.98</td>
<td style="text-align: center;">3.14</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.97</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">0.64</td>
<td style="text-align: center;">3.10</td>
<td style="text-align: center;">3.39</td>
<td style="text-align: center;">3.63</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.33</td>
<td style="text-align: center;">0.64</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">2.73</td>
<td style="text-align: center;">3.09</td>
<td style="text-align: center;">3.28</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">2.59</td>
<td style="text-align: center;">3.10</td>
<td style="text-align: center;">2.73</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">0.57</td>
<td style="text-align: center;">0.56</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">2.98</td>
<td style="text-align: center;">3.39</td>
<td style="text-align: center;">3.09</td>
<td style="text-align: center;">0.57</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">0.60</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">3.14</td>
<td style="text-align: center;">3.63</td>
<td style="text-align: center;">3.28</td>
<td style="text-align: center;">0.56</td>
<td style="text-align: center;">0.60</td>
<td style="text-align: center;">-</td>
</tr>
</tbody>
</table>
<p><strong>1단계 병합: 가장 가까운 두 매장을 먼저 병합</strong></p>
<p>거리 행렬에서 가장 작은 값은 <code>거리 = 0.3276</code>, 이는 <strong>매장 1과 매장 3</strong> 사이이다.</p>
<p><span class="math inline">\(\rightarrow\)</span> 첫 번째 병합: <strong>(1, 3)</strong></p>
<p><strong>2단계 병합: 다음으로 가까운 두 매장 병합</strong></p>
<p>다음으로 작은 거리는 <code>거리 = 0.5634</code>, 이는 <strong>매장 4와 매장 6</strong> 사이이다.</p>
<p><span class="math inline">\(\rightarrow\)</span> 두 번째 병합: <strong>(4, 6)</strong></p>
<p><strong>3단계 병합: 다음으로 가까운 조합은?</strong></p>
<p>병합된 (4, 6)과 <strong>매장 5</strong> 간의 거리가 약 0.5693로, 이는 다음으로 작은 거리이다.</p>
<p><span class="math inline">\(\rightarrow\)</span> 세 번째 병합: <strong>((4, 6), 5)</strong> → 이로써 <strong>(4, 5, 6)</strong> 이 하나의 군집으로 병합됨</p>
<p><strong>4단계 병합: (1, 3)과 매장 2 병합</strong></p>
<p>(1, 3)과 <strong>매장 2</strong> 간의 거리는 각각 다음과 같다:</p>
<p><strong>-</strong> 1-2: 0.9663 <br> <strong>-</strong> 3-2: 0.6397 <br></p>
<p>평균 거리 기준으로 계산하면 약 0.8 수준이지만, 가장 가까운 값으로 판단하면 이쯤에서 <strong>(1, 3)과 2</strong>가 병합된다.</p>
<p><span class="math inline">\(\rightarrow\)</span> 네 번째 병합: <strong>((1, 3), 2)</strong> → <strong>(1, 2, 3)</strong> 이 하나의 군집으로 병합됨</p>
<p><strong>5단계 병합: 최종 두 군집 병합</strong></p>
<p>현재 남은 군집은 두 개다:</p>
<p><strong>-</strong> 군집 A: (1, 2, 3) <br> <strong>-</strong> 군집 B: (4, 5, 6) <br></p>
<p>이 둘의 병합 거리는 가장 높은 지점에서 일어난다. 덴드로그램 상에서는 <strong>Height ≈ 5</strong> 지점에서 이뤄지는 것으로 보이며, 이는 두 군집 간 유사성이 낮다는 것을 의미한다.</p>
<p><span class="math inline">\(\rightarrow\)</span> 다섯 번째 병합: <strong>전체 군집 병합</strong></p>
</section>
<section id="실제-군집-병합-순서-정리" class="level3" data-number="10.3.6">
<h3 data-number="10.3.6" class="anchored" data-anchor-id="실제-군집-병합-순서-정리"><span class="header-section-number">10.3.6</span> 실제 군집 병합 순서 정리</h3>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">단계</th>
<th style="text-align: center;">병합 군집</th>
<th style="text-align: center;">병합 거리 (대략)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">(1, 3)</td>
<td style="text-align: center;">0.33</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">(4, 6)</td>
<td style="text-align: center;">0.56</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">((4, 6), 5)</td>
<td style="text-align: center;">0.57</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">((1, 3), 2)</td>
<td style="text-align: center;">0.64–0.96</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">(1, 2, 3) + (4, 5, 6)</td>
<td style="text-align: center;">약 5.0</td>
</tr>
</tbody>
</table>
</section>
<section id="시각적-해석-덴드로그램에서-군집-수-결정" class="level3" data-number="10.3.7">
<h3 data-number="10.3.7" class="anchored" data-anchor-id="시각적-해석-덴드로그램에서-군집-수-결정"><span class="header-section-number">10.3.7</span> 시각적 해석: 덴드로그램에서 군집 수 결정</h3>
<p>아래 그림은 전체 군집 병합 과정을 시각화한 덴드로그램이다.</p>
<p><strong>-</strong> 군집2(왼쪽 그룹): 4, 5, 6 → <strong>고객 수 많고 배달 비율 높은 매장</strong> <br> <strong>-</strong> 군집1(오른쪽 그룹): 1, 2, 3 → <strong>고객 수 적고 배달 비율 낮은 매장</strong> <br> <span class="math inline">\(\rightarrow\)</span> 이는 실제 외식산업에서 흔히 볼 수 있는 <strong>상권 기반 군집</strong> 구조이다 <br></p>
<p>덴드로그램에서 <strong>높이(Height)</strong>가 급격히 증가하는 지점(≈ 5)을 기준으로 자르면 2개의 뚜렷한 군집으로 나눌 수 있다. 이처럼 군집 수는 덴드로그램 구조에서 시각적으로 <strong>“뛰는 지점”</strong>을 기준으로 결정하는 것이 타당하다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 병합 및 덴드로그램 생성 (Ward 방법 사용)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">main =</span> <span class="st">"계층적 군집 형성 과정"</span>, <span class="at">xlab =</span> <span class="st">"매장"</span>, <span class="at">sub =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집 수 설정: k = 2</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집번호를 원 데이터에 추가</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(clusters)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집별 평균값 계산</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">by =</span> <span class="fu">list</span>(<span class="at">Cluster =</span> data<span class="sc">$</span>cluster), <span class="at">FUN =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Cluster     price customers delivery_ratio
1       1 13333.333   95.0000      0.1233333
2       2  7833.333  273.3333      0.5500000</code></pre>
</div>
</div>
<p>만약 위의 군집을 3개로 나누면 어떻게 될까?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집 수 설정: k = 3</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>clusters2 <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집번호를 원 데이터에 추가</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cluster2 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(clusters2)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집별 평균값 계산</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">by =</span> <span class="fu">list</span>(<span class="at">Cluster =</span> data<span class="sc">$</span>cluster2), <span class="at">FUN =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Cluster     price customers delivery_ratio
1       1 12500.000   97.5000           0.11
2       2 15000.000   90.0000           0.15
3       3  7833.333  273.3333           0.55</code></pre>
</div>
</div>
<p>거리를 확인해 보면, (1, 3)과 2의 거리가 (4, 6)과 5 사이의 거리보다 크기 때문에 2가 다른 그룹으로 묶였으나, 사실 위의 기술통계 값을 보면 그리 달라보이지 않는다. 이는 군집의 개수가 그만큼 중요하다는 의미이다. 군집의 개수를 잘 못 설정하면 설명하기 어려운 결과를 가지고 억지로 무언가를 해야하는 상황이 벌어지게 된다.</p>
</section>
<section id="분석-요약" class="level3" data-number="10.3.8">
<h3 data-number="10.3.8" class="anchored" data-anchor-id="분석-요약"><span class="header-section-number">10.3.8</span> 분석 요약</h3>
<p>실제 계산 결과를 보면 다음과 같은 흐름을 따라 군집이 형성되었다.</p>
<p><strong>-</strong> <strong>초기 거리 행렬</strong>을 기반으로 가장 가까운 두 관측값부터 병합 <br> <strong>-</strong> 병합이 이루어질 때마다 거리 행렬을 갱신 <br> <strong>-</strong> 이 과정을 반복하면서 덴드로그램에 병합 구조가 저장됨 <br> <strong>-</strong> 최종적으로 덴드로그램을 해석하여 군집 수 결정 <br></p>
<p>이러한 과정은 외식산업 실무에서도 매우 유용하다. 예를 들어, 매장 유형을 사전 정의하지 않고 <strong>자연스럽게 데이터에서 유사 그룹을 추출</strong>할 수 있으며, 이를 통해 지역 마케팅 전략, 메뉴 구성 전략, 서비스 유형 차별화 등에 바로 적용할 수 있다.</p>
</section>
</section>
<section id="거리-측정-방법의-선택" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="거리-측정-방법의-선택"><span class="header-section-number">10.4</span> 거리 측정 방법의 선택</h2>
<section id="왜-거리가-분석-결과를-바꾸는가" class="level3" data-number="10.4.1">
<h3 data-number="10.4.1" class="anchored" data-anchor-id="왜-거리가-분석-결과를-바꾸는가"><span class="header-section-number">10.4.1</span> 왜 ’거리’가 분석 결과를 바꾸는가</h3>
<p>계층적 군집분석의 핵심은 관측값 간의 <strong>거리(distance)</strong>를 기반으로 한다는 점이다. 그런데 이 거리의 계산 방식이 달라지면, 결국 군집 형성도 완전히 달라진다. 왜냐하면, 거리는 결국 군집간의 <strong>유사성(similarity)</strong>을 의미하는 것이기 때문이다. 거리가 멀다면 유사성이 낮은 것이고, 거리가 가깝다면 유사성이 높은 것이다. 유사성이 높은 것들끼리 묶는 것이 군집분석의 핵심인데, 거리를 측정하는 방법이 달라진다는 것은 유사성이 달라진다는 의미이다. 즉, <strong>어떤 거리 측정 방법을 선택하느냐가 군집분석의 결과를 좌우한다</strong>는 말이다.</p>
<p>예를 들어 고객 A와 고객 B는 평균 객단가는 비슷하지만, 방문 빈도나 배달 비율이 다를 수 있다. 이럴 때 어느 항목의 차이를 더 중요하게 반영할 것인지에 따라 두 고객 간의 유사성 해석은 달라질 수밖에 없다.</p>
</section>
<section id="연속형-변수일-때-사용할-수-있는-거리-측정-방법" class="level3" data-number="10.4.2">
<h3 data-number="10.4.2" class="anchored" data-anchor-id="연속형-변수일-때-사용할-수-있는-거리-측정-방법"><span class="header-section-number">10.4.2</span> 연속형 변수일 때 사용할 수 있는 거리 측정 방법</h3>
<p>외식산업 데이터를 분석할 때 가장 흔하게 접하는 데이터는 <strong>연속형 변수</strong>다. 예를 들어 ‘가격’, ‘방문빈도’, ‘배달 비율’, ‘테이블 회전수’ 등은 연속값으로 측정된다.</p>
<p>이 경우 사용할 수 있는 대표적인 거리 계산 방법은 다음과 같다.</p>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">거리 측정법</th>
<th style="text-align: center;">설명</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">유클리드 거리</td>
<td style="text-align: center;">피타고라스의 공식으로 계산된 직선 거리</td>
</tr>
<tr class="even">
<td style="text-align: center;">맨하튼 거리</td>
<td style="text-align: center;">축을 따라 이동하는 거리, 절대값의 합</td>
</tr>
<tr class="odd">
<td style="text-align: center;">마할라노비스 거리</td>
<td style="text-align: center;">공분산 행렬을 반영하여 변수 간 상관성 고려</td>
</tr>
<tr class="even">
<td style="text-align: center;">표준화 거리</td>
<td style="text-align: center;">변수 단위가 다른 경우 표준화한 후 유클리드 계산</td>
</tr>
</tbody>
</table>
<p>유클리드 거리는 가장 일반적으로 사용되며, 변수 간 단위가 동일하거나 표준화되어 있다면 효과적이다.<br>
맨하튼 거리는 극단값에 덜 민감하며, 도시 블록처럼 이동하는 경로를 상정한다.<br>
마할라노비스 거리는 변수 간 상관관계를 반영하므로, 공선성이 높은 경우 유용하다.</p>
</section>
<section id="연속형변수-거리-측정법의-예제" class="level3" data-number="10.4.3">
<h3 data-number="10.4.3" class="anchored" data-anchor-id="연속형변수-거리-측정법의-예제"><span class="header-section-number">10.4.3</span> 연속형변수 거리 측정법의 예제</h3>
<p>계층적 군집분석의 출발점은 ’두 데이터 간 얼마나 비슷하거나 다른가’를 측정하는 것이고, 이를 위해 <strong>거리(distance)</strong>라는 수치 개념을 사용한다. 그런데 이 거리를 계산하는 방식은 다양하며, 상황에 따라 적절한 방법을 골라야 한다. 여기서는 네 가지 주요 거리 측정법을 <strong>하나의 예시 데이터</strong>에 적용하여, 결과가 어떻게 달라지는지 구체적으로 비교해본다.</p>
<p><strong>예제 데이터: 외식 매장 두 곳의 운영 데이터</strong></p>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 10%">
<col style="width: 30%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">매장</th>
<th style="text-align: center;">평균 가격 <br> (<code>price</code>)</th>
<th style="text-align: center;">하루 고객 수 <br> (<code>customers</code>)</th>
<th style="text-align: center;">배달 비율 <br> (<code>delivery_ratio</code>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A</td>
<td style="text-align: center;">12000원</td>
<td style="text-align: center;">100명</td>
<td style="text-align: center;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: center;">B</td>
<td style="text-align: center;">15000원</td>
<td style="text-align: center;">90명</td>
<td style="text-align: center;">0.15</td>
</tr>
</tbody>
</table>
<p>이제 위 데이터를 기반으로 다양한 거리 계산법을 적용한다.</p>
<p><strong>유클리드 거리 (Euclidean Distance)</strong></p>
<p><strong>정의</strong>: 두 점 사이의 ’직선 거리’이며, 피타고라스 정리에 기반함.</p>
<p><span class="math display">\[
d_{euclidean}(A, B) = \sqrt{(x_1 - x_2)^2 + (y_1 - y_2)^2 + (z_1 - z_2)^2}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12000</span>, <span class="dv">100</span>, <span class="fl">0.1</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">15000</span>, <span class="dv">90</span>, <span class="fl">0.15</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>euclidean <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>((a <span class="sc">-</span> b)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>euclidean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3000.017</code></pre>
</div>
</div>
<p>문제는 이 경우 단위의 영향을 많이 받는 다는 점이다. 누가 봐도 평균가격의 영향이 가장 크게 나타났다는 것을 알 수 있다. 세 변수에서 차이가 클수록 거리가 커지며, 모든 변수의 단위가 동일하거나 표준화되었을 때 효과적이다.여기서는 가격과 다른 변수의 단위(unit) 차이가 크기 때문에 이 항목이 거리 계산에 큰 영향을 준다.</p>
<p><strong>맨하튼 거리 (Manhattan Distance)</strong></p>
<p><strong>정의</strong>: 각 축을 따라 움직이는 거리의 합. ’도시 블록 거리’라고도 불린다.</p>
<p><span class="math display">\[
d_{\text{Manhattan}}(A, B) = \sum_{i=1}^{n} \left| x_i - y_i \right|
\]</span></p>
<p><span class="math display">\[
d_{\text{Manhattan}}(A, B) = |x_1 - y_1| + |x_2 - y_2| + \cdots + |x_n - y_n|
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>manhattan <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(a <span class="sc">-</span> b))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>manhattan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3010.05</code></pre>
</div>
</div>
<p>절대값의 합이므로 극단값에 덜 민감하다. 데이터에 이상치가 있을 때는 유클리드보다 안정적이다. 그러나 여전히 변수의 단위에 영향을 받고 있으므로 표준화하지 않으면 엉뚱한 결과를 보게된다.</p>
<p><strong>마할라노비스 거리 (Mahalanobis Distance)</strong></p>
<p><strong>정의</strong>: 공분산 행렬을 활용해, 변수 간 상관성을 반영한 거리 측정 방식.</p>
<p><span class="math display">\[
d_{\text{Mahalanobis}}(x, \mu) = \sqrt{(x - \mu)^{\top} S^{-1} (x - \mu)}
\]</span></p>
<p><strong>-</strong> <span class="math inline">\(x\)</span>: 관측값 벡터 (예: 한 외식 매장의 특성값) <br> <strong>-</strong> <span class="math inline">\(\mu\)</span>: 평균 벡터 (전체 평균 혹은 기준 그룹의 평균) <br> <strong>-</strong> <span class="math inline">\(S\)</span>: 공분산 행렬(각 변수간의 공분산을 담은 행렬) <br> <strong>-</strong> <span class="math inline">\(S^{-1}\)</span>: 공분산의 역행렬 <br> <strong>-</strong> <span class="math inline">\(T\)</span>: 전치(transpose)기호 <br></p>
<p>마할라노비스 거리는 단순한 변수 간 차이가 아닌, 변수 간의 상관관계와 분산을 고려하여 거리 계산을 수행한다. 따라서, 변수들이 서로 상관성이 높거나 단위가 다를 때 유리하고 일반적인 거리 측정보다 더 정규화된 판단을 제공하며, 이상치 탐지에도 자주 활용된다.</p>
<p>예시 계산은 데이터 수가 부족하여 생략하고, 아래와 같이 설명한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>library(MASS)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>x &lt;- rbind(a, b)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu"># 공분산 행렬 확인</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>cov(x)  # 2행 3열이기 때문에 특이행렬</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># 일반화 역행렬을 사용하여 마할라노비스 거리 계산</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>mahal &lt;- mahalanobis(x, center = colMeans(x), cov = ginv(cov(x)))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>mahal</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>변수 간 상관관계가 있는 경우 이 거리 계산이 더 정밀한 판단을 가능하게 한다. 예를 들어 price와 delivery_ratio가 상관되어 있을 경우, 마할라노비스 거리는 그 상관성을 고려하여 거리를 조정한다.</p>
</section>
<section id="표준화-거리-standardized-euclidean-distance" class="level3" data-number="10.4.4">
<h3 data-number="10.4.4" class="anchored" data-anchor-id="표준화-거리-standardized-euclidean-distance"><span class="header-section-number">10.4.4</span> 표준화 거리 (Standardized Euclidean Distance)</h3>
<p><strong>정의</strong>: 변수들의 단위가 다를 경우, 각 변수들을 <strong>표준화(평균 0, 표준편차 1)</strong>한 후 유클리드 거리 계산</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>scaled_a <span class="ot">&lt;-</span> <span class="fu">scale</span>(a)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>scaled_b <span class="ot">&lt;-</span> <span class="fu">scale</span>(b)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>euclidean_scaled <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>((scaled_a <span class="sc">-</span> scaled_b)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>euclidean_scaled</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002880258</code></pre>
</div>
</div>
<p>###시각적 이해: 2차원 공간에서 거리 비교</p>
<p>만약 price와 customers 두 변수만 고려한다고 가정하면, 각 거리 측정법은 아래와 같은 형태로 이해할 수 있다.</p>
<p><strong>-</strong> 유클리드 거리: <span class="math inline">\(\searrow\)</span> 대각선 방향의 직선 거리 (빨간선) <br> <strong>-</strong> 맨하튼 거리: <span class="math inline">\(\rightarrow\)</span> 아래로, 그 다음 왼쪽으로 (혹은 반대 방향)의 꺾인 거리 (파란선)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 시각화 예제</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">12000</span>, <span class="dv">15000</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">90</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">12000</span>, <span class="at">y =</span> <span class="dv">100</span>, <span class="at">xend =</span> <span class="dv">15000</span>, <span class="at">yend =</span> <span class="dv">90</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">12000</span>, <span class="at">y =</span> <span class="dv">100</span>, <span class="at">xend =</span> <span class="dv">15000</span>, <span class="at">yend =</span> <span class="dv">100</span>), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">15000</span>, <span class="at">y =</span> <span class="dv">100</span>, <span class="at">xend =</span> <span class="dv">15000</span>, <span class="at">yend =</span> <span class="dv">90</span>), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"유클리드 거리(빨간선) vs 맨하튼 거리(파란선)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>위 그래프를 보면 유클리드 거리는 더 짧지만 실제 이동 경로는 맨하튼 거리와 같지 않다. 분석 목적이 <strong>실제 거리</strong>에 가까운지, <strong>이동 비용</strong>에 가까운지에 따라 선택이 달라진다.</p>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 40%">
<col style="width: 60%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">거리 측정법</th>
<th style="text-align: left;">추천 상황</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">유클리드 거리</td>
<td style="text-align: left;">변수 단위가 동일하고 이상치 영향이 작을 때</td>
</tr>
<tr class="even">
<td style="text-align: center;">맨하튼 거리</td>
<td style="text-align: left;">이상치에 민감하지 않고 거리 누적이 중요한 경우</td>
</tr>
<tr class="odd">
<td style="text-align: center;">마할라노비스 거리</td>
<td style="text-align: left;">변수 간 상관관계가 존재하고 데이터가 충분할 때</td>
</tr>
<tr class="even">
<td style="text-align: center;">표준화 거리</td>
<td style="text-align: left;">변수 단위가 달라서 조정이 필요한 경우</td>
</tr>
</tbody>
</table>
<p>거리 측정법의 선택은 단순한 수학 공식의 문제가 아니라, 데이터의 특성과 분석의 목적을 반영하는 전략적 판단이다. 같은 데이터라도 어떤 거리 측정법을 쓰느냐에 따라 군집 결과가 달라질 수 있다는 점을 항상 기억해야 한다.</p>
</section>
<section id="명목형-변수에서는-유사도-계수를-사용한다" class="level3" data-number="10.4.5">
<h3 data-number="10.4.5" class="anchored" data-anchor-id="명목형-변수에서는-유사도-계수를-사용한다"><span class="header-section-number">10.4.5</span> 명목형 변수에서는 유사도 계수를 사용한다</h3>
<p>외식산업 실무에서는 간혹 명목형 변수도 포함된다. 예를 들어 다음과 같은 변수들이다.</p>
<p><strong>-</strong> 매장 유형: 단독, 쇼핑몰, 푸드코트 <br> <strong>-</strong> 운영 시간대: 24시간, 오전~저녁, 오후~심야 <br> <strong>-</strong> 결제 방식: 현금, 카드, 배달앱 <br></p>
<p>이런 경우에는 직접적인 거리 계산이 불가능하므로, <strong>유사도 계수(Similarity coefficient)</strong>를 활용해야 한다. 대표적인 계수는 다음과 같다.</p>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">계수 이름</th>
<th style="text-align: center;">거리 환산식</th>
<th style="text-align: center;">특징</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Jaccard</td>
<td style="text-align: center;">거리 = 1 – Jaccard 계수</td>
<td style="text-align: center;">일치 항목 비중 기준</td>
</tr>
<tr class="even">
<td style="text-align: center;">Dice</td>
<td style="text-align: center;">거리 = 1 – Dice 계수</td>
<td style="text-align: center;">민감한 일치 강조</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Russel &amp; Rao</td>
<td style="text-align: center;">거리 = 1 – RR 계수</td>
<td style="text-align: center;">단순한 매칭 중심</td>
</tr>
</tbody>
</table>
<p>그러나 위의 내용만으로는 이해가 잘 되지 않을 것이다. 다음의 예제들을 보면서 알아보자.</p>
<p>명목형 변수(예: 배달 여부, 브랜드, 결제 방식 등)는 수치형이 아니기 때문에 일반적인 유클리드 거리로는 비교할 수 없다. 대신 <strong>유사도 계수(similarity coefficient)</strong>를 통해 항목 간의 일치도를 계산하고, 이를 1에서 빼서 <strong>거리(distance)</strong>로 변환한다.</p>
<p>예를 들어 두 매장이 다음과 같은 속성을 갖는다고 하자:</p>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 40%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">항목</th>
<th style="text-align: center;">매장 A</th>
<th style="text-align: center;">매장 B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">배달 가능</td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: center;">포장 가능</td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;">No</td>
</tr>
<tr class="odd">
<td style="text-align: center;">테이블 결제</td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">No</td>
</tr>
<tr class="even">
<td style="text-align: center;">포인트 적립</td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: center;">제로페이 사용</td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;">No</td>
</tr>
</tbody>
</table>
<p>이를 기반으로 다음과 같이 <strong>a, b, c, d</strong> 값을 정의한다:</p>
<ul>
<li>a = Yes-Yes = 2개</li>
<li>b = Yes-No = 2개</li>
<li>c = No-Yes = 0개</li>
<li>d = No-No = 1개</li>
</ul>
<p><strong>Jaccard 계수</strong></p>
<p><span class="math display">\[
\text{Jaccard} = \frac{a}{a + b + c} \quad\Rightarrow\quad \text{Distance} = 1 - \frac{a}{a + b + c}
\]</span></p>
<p><strong>특징</strong>: No-No 항목은 제외하고 <strong>공통적으로 긍정된 특성</strong>에만 집중</p>
<p><strong>예시 해석</strong>: 두 매장은 제공하는 기능 중 2개가 일치하고 2개는 한쪽만 제공함. → Jaccard 계수는 0.5, 거리 = 0.5</p>
<p><strong>Sorensen-Dice 계수</strong></p>
<p><span class="math display">\[
\text{Dice} = \frac{2a}{2a + b + c} \quad\Rightarrow\quad \text{Distance} = 1 - \frac{2a}{2a + b + c}
\]</span></p>
<p><strong>특징</strong>: 일치한 부분을 <strong>2배 강조</strong>함</p>
<p><strong>예시 해석</strong>: 동일한 기능 2개를 더 강하게 반영 <span class="math inline">\(\rightarrow\)</span> 유사도 상승</p>
<p><strong>Anderberg 계수</strong></p>
<p><span class="math display">\[
\text{Anderberg} = \frac{a}{a + 2(b + c)}
\]</span></p>
<p><strong>특징</strong>: 불일치 항목에 더 많은 패널티를 부여</p>
<p><strong>예시 해석</strong>: 불일치한 항목이 많을 경우 유사도가 급격히 낮아짐</p>
<p><strong>Ochiai 계수</strong></p>
<p><span class="math display">\[
\text{Ochiai} = \frac{a}{\sqrt{(a + b)(a + c)}}
\]</span></p>
<p><strong>특징</strong>: 벤 다이어그램에서 교집합을 전체 곱셈 대비로 보는 개념</p>
<p><strong>활용</strong>: 두 매장이 모두 특정 기능을 가지고 있을 때만 유사도 인정</p>
<p><strong>Simple Matching 계수</strong></p>
<p><span class="math display">\[
\text{Simple Matching} = \frac{a + d}{a + b + c + d}
\]</span></p>
<p><strong>특징</strong>: Yes-Yes, No-No 모두를 동일하게 <strong>일치로 간주</strong></p>
<p><strong>예시 해석</strong>: 포장 가능 여부가 다르지만, 테이블 결제가 둘 다 없기 때문에 그 역시 일치로 본다</p>
<p><strong>Rogers and Tanimoto 계수</strong></p>
<p><span class="math display">\[
\text{Rogers-Tanimoto} = \frac{a + d}{a + d + 2(b + c)}
\]</span></p>
<p><strong>특징</strong>: 불일치 항목에 2배 패널티 <span class="math inline">\(\rightarrow\)</span> 더 민감한 거리 측정</p>
<p><strong>Phi 계수 (상관 계수 기반)</strong></p>
<p><span class="math display">\[
\phi = \frac{ad - bc}{\sqrt{(a + b)(c + d)(a + c)(b + d)}}
\]</span></p>
<p><strong>특징</strong>: 실제 상관 계수처럼 작동함. +1 완전일치, 0 무관, -1 완전 불일치</p>
<p><strong>Russel &amp; Rao 계수</strong></p>
<p><span class="math display">\[
\text{Russel-Rao} = \frac{a}{a + b + c + d} \quad\Rightarrow\quad \text{Distance} = 1 - \frac{a}{a + b + c + d}
\]</span></p>
<p><strong>특징</strong>: Yes-Yes 항목만 고려. 나머지는 무시</p>
<p><strong>거리로 환산하는 공식</strong></p>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 30%">
<col style="width: 33%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">계수 이름</th>
<th style="text-align: left;">거리 환산식</th>
<th style="text-align: center;">특징</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Jaccard</td>
<td style="text-align: left;"><span class="math inline">\(D = 1 - \frac{a}{a + b + c}\)</span></td>
<td style="text-align: center;">공통된 긍정 항목 중심</td>
</tr>
<tr class="even">
<td style="text-align: center;">Sorensen-Dice</td>
<td style="text-align: left;"><span class="math inline">\(D = 1 - \frac{2a}{2a + b + c}\)</span></td>
<td style="text-align: center;">민감한 일치 강조</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Simple Matching</td>
<td style="text-align: left;"><span class="math inline">\(D = 1 - \frac{a + d}{a + b + c + d}\)</span></td>
<td style="text-align: center;">전체 일치 반영</td>
</tr>
<tr class="even">
<td style="text-align: center;">Rogers-Tanimoto</td>
<td style="text-align: left;"><span class="math inline">\(D = 1 - \frac{a + d}{a + d + 2(b + c)}\)</span></td>
<td style="text-align: center;">불일치에 민감</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Ochiai</td>
<td style="text-align: left;"><span class="math inline">\(D = 1 - \frac{a}{\sqrt{(a + b)(a + c)}}\)</span></td>
<td style="text-align: center;">교차 일치 강조</td>
</tr>
<tr class="even">
<td style="text-align: center;">Phi coefficient</td>
<td style="text-align: left;"><span class="math inline">\(D = 1 - \phi\)</span></td>
<td style="text-align: center;">상관 기반, 해석력 높음</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Russel-Rao</td>
<td style="text-align: left;"><span class="math inline">\(D = 1 - \frac{a}{a + b + c + d}\)</span></td>
<td style="text-align: center;">단순 Yes 일치만 반영</td>
</tr>
</tbody>
</table>
<p><strong>외식산업 응용 예시</strong></p>
<table class="table-striped table-hover table">
<thead>
<tr class="header">
<th style="text-align: center;">매장명</th>
<th style="text-align: center;">배달</th>
<th style="text-align: center;">포장</th>
<th style="text-align: center;">테이블결제</th>
<th style="text-align: center;">포인트</th>
<th style="text-align: center;">제로페이</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr class="even">
<td style="text-align: center;">B</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
</tr>
</tbody>
</table>
<p>이러한 이진형 변수들을 <strong>거리 행렬로 변환</strong>하면 매장들 간 <strong>비정량적 특성 기반 유사성 분석</strong>이 가능하다. 이는 외식 브랜드의 <strong>운영 특성별 세분화 전략</strong>에 핵심적으로 활용될 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 명목형 유사도 계수 계산 예제</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 교차표 예시</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">10</span>  <span class="co"># 1-1 매칭</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">5</span>   <span class="co"># 1-0 매칭</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">3</span>   <span class="co"># 0-1 매칭</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">20</span>  <span class="co"># 0-0 매칭</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 유사도 계수 계산</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>jaccard <span class="ot">&lt;-</span> a <span class="sc">/</span> (a <span class="sc">+</span> b <span class="sc">+</span> c)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>dice <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> a) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> a <span class="sc">+</span> b <span class="sc">+</span> c)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>anderberg <span class="ot">&lt;-</span> a <span class="sc">/</span> (a <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> (b <span class="sc">+</span> c))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>ochiai <span class="ot">&lt;-</span> a <span class="sc">/</span> <span class="fu">sqrt</span>((a <span class="sc">+</span> b) <span class="sc">*</span> (a <span class="sc">+</span> c))</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>simple_matching <span class="ot">&lt;-</span> (a <span class="sc">+</span> d) <span class="sc">/</span> (a <span class="sc">+</span> b <span class="sc">+</span> c <span class="sc">+</span> d)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>rogers_tanimoto <span class="ot">&lt;-</span> (a <span class="sc">+</span> d) <span class="sc">/</span> (a <span class="sc">+</span> d <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> (b <span class="sc">+</span> c))</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> (a <span class="sc">*</span> d <span class="sc">-</span> b <span class="sc">*</span> c) <span class="sc">/</span> <span class="fu">sqrt</span>((a <span class="sc">+</span> b)<span class="sc">*</span>(c <span class="sc">+</span> d)<span class="sc">*</span>(a <span class="sc">+</span> c)<span class="sc">*</span>(b <span class="sc">+</span> d))</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>russel_rao <span class="ot">&lt;-</span> a <span class="sc">/</span> (a <span class="sc">+</span> b <span class="sc">+</span> c <span class="sc">+</span> d)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 거리로 환산</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>distance_jaccard <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> jaccard</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>distance_dice <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> dice</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>distance_russel_rao <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> russel_rao</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 결과 출력</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  계수 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Jaccard"</span>, <span class="st">"Dice"</span>, <span class="st">"Anderberg"</span>, <span class="st">"Ochiai"</span>, <span class="st">"Simple Matching"</span>, </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Rogers &amp; Tanimoto"</span>, <span class="st">"Phi Coefficient"</span>, <span class="st">"Russel &amp; Rao"</span>),</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  유사도 <span class="ot">=</span> <span class="fu">c</span>(jaccard, dice, anderberg, ochiai, simple_matching, </span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>           rogers_tanimoto, phi, russel_rao),</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  거리 <span class="ot">=</span> <span class="fu">c</span>(distance_jaccard, distance_dice, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, distance_russel_rao)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               계수    유사도      거리
1           Jaccard 0.5555556 0.4444444
2              Dice 0.7142857 0.2857143
3         Anderberg 0.3846154        NA
4            Ochiai 0.7161149        NA
5   Simple Matching 0.7894737        NA
6 Rogers &amp; Tanimoto 0.6521739        NA
7   Phi Coefficient 0.5524850        NA
8      Russel &amp; Rao 0.2631579 0.7368421</code></pre>
</div>
</div>
<p><strong>왜 일부 계수만 거리로 환산했는가?</strong></p>
<p><strong>1. Jaccard, Dice, Russel &amp; Rao</strong> <br></p>
<p>이 세 계수는 기본적으로 “유사도”를 0 ~ 1 범위로 반환하며, 1 - 유사도로 직관적인 거리값으로 해석 가능하다. 예를들어, Jaccard 계수가 0.8이면, 거리 = 1 – 0.8 = 0.2로 <strong>“비슷하지 않음의 정도”</strong>로 볼 수 있다.</p>
<p><strong>2. Anderberg, Ochiai, Simple Matching, Rogers-Tanimoto</strong> <br></p>
<p>이 계수들도 유사도 척도이긴 하지만, 다음과 같은 이유로 거리로 직접 환산하기 애매하거나 조심이 필요하다.</p>
<p><strong>-</strong> Anderberg: 분모에 2(b + c)가 들어가는 비대칭적인 구조로 인해 거리로 해석할 때 오해의 소지가 있음 <br> <strong>-</strong> Ochiai: 코사인 유사도와 유사한 구조를 가지므로 거리로 환산할 경우 제곱 또는 삼각함수를 사용하는 다른 전환이 필요함 (단순 1–유사도는 왜곡 가능성 존재) <br> <strong>-</strong> Simple Matching: 0-0 매칭도 유사도로 간주되기 때문에, 거리로의 환산이 문맥에 따라 다르게 해석될 수 있음 <br> <strong>-</strong> Rogers-Tanimoto: 단순한 거리 환산보다는 명목형 속성이 다수일 때의 보정 계수로 해석되는 경향이 있음 <br></p>
<p><strong>3. Phi Coefficient</strong> <br></p>
<p>상관계수 기반이라 음수(~ -1)부터 양수(+1)까지 값을 가지기 때문에, 단순히 1 - phi로 거리화하면 음의 상관이 더 멀다는 해석이 잘못 전달될 수 있다. 일반적으로는 <span class="math inline">\(1 - |\text{phi}|\)</span> 또는 <span class="math inline">\(\sqrt{1 - r^2}\)</span>등의 보정된 전환이 필요하다.</p>
<p>그러므로, 단순히 <span class="math inline">\(거리 = 1 - 유사도\)</span> 방식이 유효한 전환인지는 계수의 정의에 따라 다르다. <strong>“거리 변환이 가능한 계수와 그렇지 않은 계수를 구분하여 사용”</strong>하는 것이 더 정확하다.</p>
</section>
<section id="연속형과-명목형이-섞이면-어떻게-할까" class="level3" data-number="10.4.6">
<h3 data-number="10.4.6" class="anchored" data-anchor-id="연속형과-명목형이-섞이면-어떻게-할까"><span class="header-section-number">10.4.6</span> 연속형과 명목형이 섞이면 어떻게 할까?</h3>
<p>현실에서는 연속형 변수와 명목형 변수가 혼합된 형태로 존재하는 경우가 많다. 예를 들어 다음과 같은 매장 데이터가 있을 수 있다.</p>
<table class="table-striped table-hover table">
<thead>
<tr class="header">
<th style="text-align: center;">매장</th>
<th style="text-align: center;">객단가 (연속형)</th>
<th style="text-align: center;">배달비율 (연속형)</th>
<th style="text-align: center;">운영유형 (명목형)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A</td>
<td style="text-align: center;">12000</td>
<td style="text-align: center;">0.2</td>
<td style="text-align: center;">쇼핑몰</td>
</tr>
<tr class="even">
<td style="text-align: center;">B</td>
<td style="text-align: center;">8500</td>
<td style="text-align: center;">0.6</td>
<td style="text-align: center;">단독</td>
</tr>
</tbody>
</table>
<p>이처럼 혼합형 변수 구조에서는 일반적인 거리 계산 방식으로는 한계가 생긴다. 이럴 때 사용하는 방법이 바로 <strong>Gower 거리(Gower Distance)</strong>이다. Gower 거리는 각 변수의 유형에 맞는 거리 계산 방식을 혼합하여 전체 유사도를 계산하는 방식이다.</p>
<p>Gower 거리는 cluster 패키지의 daisy() 함수에서 사용 가능하다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>mixed_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">12000</span>, <span class="dv">8500</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">delivery =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.6</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="st">"쇼핑몰"</span>, <span class="st">"단독"</span>))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>dist_gower <span class="ot">&lt;-</span> <span class="fu">daisy</span>(mixed_data, <span class="at">metric =</span> <span class="st">"gower"</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>dist_gower</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dissimilarities :
  1
2 1

Metric :  mixed ;  Types = I, I, N 
Number of objects : 2</code></pre>
</div>
</div>
<p>위의 결과를 보면, 관측치 1과 관측치 2 사이의 비유사도(dissimilarity) 값이 1이라는 뜻이다. 즉, <strong>가우어 거리는 1.0 (가장 멀다 / 완전히 다르다)</strong>는 의미이다. 가우어 거리의 값은 항상 $0 $범위를 가지며, 0이면 완전히 동일, 1이면 완전히 다름을 의미한다.</p>
<p>그러나 주의해야 할 점이 있다. Gower 거리는 변수 간 상대적 중요도를 동일하게 간주하기 때문에, 변수 표준화가 잘못되거나 명목형 변수가 과도하게 많을 경우 분석 왜곡이 발생할 수 있다.</p>
</section>
<section id="실무-팁-변수-선택이-거리보다-더-중요할-수-있다" class="level3" data-number="10.4.7">
<h3 data-number="10.4.7" class="anchored" data-anchor-id="실무-팁-변수-선택이-거리보다-더-중요할-수-있다"><span class="header-section-number">10.4.7</span> 실무 팁: 변수 선택이 거리보다 더 중요할 수 있다</h3>
<p>군집분석에서는 거리 측정 방식만큼 중요한 것이 <strong>변수 선택</strong>이다. 예를 들어 배달 비율이 매우 중요한 상황에서 이 변수의 스케일이 작거나 단위가 다르다면 거리 계산에 제대로 반영되지 않을 수 있다. 이럴 땐 <strong>표준화를 반드시 수행</strong>해야 하며, <strong>분석 목적에 맞는 변수만 선택해서 사용</strong>하는 것이 필요하다.</p>
<p>혼합형 변수를 사용할 수 있다고 해서, 무조건 Gower 거리로 모든 걸 해결하려고 하면 해석이 어려워질 수 있다. 가능하면 변수는 동일한 형태로 정제하고, 필요 시 군집을 나누어 따로 분석하는 것도 좋은 전략이다.</p>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">변수 유형</th>
<th style="text-align: center;">추천 거리 측정 방법</th>
<th style="text-align: center;">비고</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">연속형</td>
<td style="text-align: center;">유클리드, 맨하튼, 마할라노비스</td>
<td style="text-align: center;">표준화 필수</td>
</tr>
<tr class="even">
<td style="text-align: center;">명목형</td>
<td style="text-align: center;">Jaccard, Dice, Gower</td>
<td style="text-align: center;">이진 변환 필요</td>
</tr>
<tr class="odd">
<td style="text-align: center;">혼합형</td>
<td style="text-align: center;">Gower</td>
<td style="text-align: center;">해석이 어렵고 왜곡 가능</td>
</tr>
</tbody>
</table>
<p>분석에 들어가기 전, <strong>변수의 속성과 거리 계산 방법을 충분히 검토</strong>하는 것이 계층적 군집분석의 성패를 좌우하는 핵심이다.</p>
</section>
</section>
<section id="군집분석-알고리즘의-핵심" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="군집분석-알고리즘의-핵심"><span class="header-section-number">10.5</span> 군집분석 알고리즘의 핵심</h2>
<p>군집분석에서 가장 중요한 판단 중 하나는 <strong>어떻게 군집 간의 거리를 정의할 것인가</strong>이다. 군집 간 거리를 측정하는 방식에 따라 <strong>군집 병합 방식이 달라지며</strong>, 이는 곧 최종 군집 결과에 큰 영향을 미친다. 같은 데이터를 사용하더라도 <strong>단일 연결법</strong>과 <strong>Ward 방법</strong>은 전혀 다른 결과를 낼 수 있다. 따라서 알고리즘을 선택하기 전, <strong>각 방법이 어떤 특성을 가지며 어떤 데이터 구조에 적합한지를 명확히 이해</strong>하는 것이 중요하다.</p>
<section id="군집-간-거리-계산의-의미" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1" class="anchored" data-anchor-id="군집-간-거리-계산의-의미"><span class="header-section-number">10.5.1</span> 군집 간 거리 계산의 의미</h3>
<p>군집분석에서 “거리”는 단순한 물리적 거리뿐 아니라 <strong>속성의 유사성</strong>을 의미한다. 예를 들어 아래와 같은 두 고객을 생각해보자.</p>
<table class="table-striped table-hover table">
<thead>
<tr class="header">
<th style="text-align: center;">고객</th>
<th style="text-align: center;">월 방문횟수</th>
<th style="text-align: center;">1회 평균 지출</th>
<th style="text-align: center;">선호 메뉴</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A 고객</td>
<td style="text-align: center;">12회</td>
<td style="text-align: center;">15,000원</td>
<td style="text-align: center;">디저트</td>
</tr>
<tr class="even">
<td style="text-align: center;">B 고객</td>
<td style="text-align: center;">3회</td>
<td style="text-align: center;">20,000원</td>
<td style="text-align: center;">커피</td>
</tr>
</tbody>
</table>
<p>이 두 고객은 지출액은 비슷하지만, 방문 패턴과 메뉴 선호가 다르다. 이런 고객을 어떻게 군집화할 것인지는 <strong>군집 간 거리 정의 방식</strong>에 따라 달라진다.</p>
</section>
<section id="시각적-예-군집-간-거리-계산-방식" class="level3" data-number="10.5.2">
<h3 data-number="10.5.2" class="anchored" data-anchor-id="시각적-예-군집-간-거리-계산-방식"><span class="header-section-number">10.5.2</span> 시각적 예: 군집 간 거리 계산 방식</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 불러오기</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>customer_pos <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/ch10_data1.csv"</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 범주형 변수 factor로 변환</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>customer_pos<span class="sc">$</span>day_pref <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(customer_pos<span class="sc">$</span>day_pref)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>customer_pos<span class="sc">$</span>menu_pref <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(customer_pos<span class="sc">$</span>menu_pref)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 가우어 거리 계산 (혼합형 데이터)</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>gower_dist <span class="ot">&lt;-</span> <span class="fu">daisy</span>(customer_pos, <span class="at">metric =</span> <span class="st">"gower"</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(customer_pos, <span class="fu">aes</span>(visit_freq, avg_spend, <span class="at">label =</span> id)) <span class="sc">+</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_y =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"고객 위치 예시 (2차원 거리)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>위 그래프는 평균 소비금액(avg_spend)와 방문횟수(visit_freq)를 기준으로 맵핑한 결과이다. 눈으로 보면 두 그룹정도로 나누어져 있지만 중간에 두 그룹을 연결할 만한 몇 개의 관측값이 보인다. 이제 다양한 연결법으로 테스트를 해보자.</p>
</section>
<section id="단일-연결법-single-linkage" class="level3" data-number="10.5.3">
<h3 data-number="10.5.3" class="anchored" data-anchor-id="단일-연결법-single-linkage"><span class="header-section-number">10.5.3</span> 단일 연결법 (Single Linkage)</h3>
<p>단일 연결법은 두 군집 간에서 <strong>가장 가까운 두 점</strong> 사이의 거리를 기준으로 병합 여부를 판단한다. 두 군집이 하나의 긴 체인으로 연결되더라도, <strong>두 점만 가깝다면 병합</strong>이 이루어진다. 이로 인해 <strong>Chain Effect</strong>, 즉 긴 연결형 군집이 형성되는 경우가 많다.</p>
<section id="외식산업-예시" class="level4" data-number="10.5.3.1">
<h4 data-number="10.5.3.1" class="anchored" data-anchor-id="외식산업-예시"><span class="header-section-number">10.5.3.1</span> 외식산업 예시</h4>
<p>예를 들어 <strong>매장 방문 시간이 자정에 몰리는 고객</strong>과 <strong>밤 11시에 방문하는 고객</strong>은 단일 연결법에서는 하나의 군집으로 묶일 수 있다. 단지 그 사이의 고객이 하나라도 존재하면 연결고리를 만들어주기 때문이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>hc_single <span class="ot">&lt;-</span> <span class="fu">hclust</span>(gower_dist, <span class="at">method =</span> <span class="st">"single"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_single, <span class="at">labels =</span> customer_pos<span class="sc">$</span>id, <span class="at">main =</span> <span class="st">"Single Linkage Dendrogram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="완전-연결법-complete-linkage" class="level3" data-number="10.5.4">
<h3 data-number="10.5.4" class="anchored" data-anchor-id="완전-연결법-complete-linkage"><span class="header-section-number">10.5.4</span> 완전 연결법 (Complete Linkage)</h3>
<p>완전 연결법은 <strong>두 군집 중 가장 멀리 떨어진 점 간 거리</strong>를 기준으로 병합 여부를 판단한다. 이 방법은 군집 간 가장 먼 거리까지 고려하므로, <strong>더 응집력 있는 군집을 형성</strong>한다.</p>
<section id="외식산업-예시-1" class="level4" data-number="10.5.4.1">
<h4 data-number="10.5.4.1" class="anchored" data-anchor-id="외식산업-예시-1"><span class="header-section-number">10.5.4.1</span> 외식산업 예시</h4>
<p>브런치 전문점이 고객을 분류할 때, <strong>모든 고객이 비슷한 지출을 할 경우</strong>에 유용하다. 어떤 고객이라도 너무 멀리 떨어져 있으면 군집이 병합되지 않기 때문에, <strong>일관된 소비 성향을 가진 고객군</strong>을 만들 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>hc_complete <span class="ot">&lt;-</span> <span class="fu">hclust</span>(gower_dist, <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_complete, <span class="at">labels =</span> customer_pos<span class="sc">$</span>id, <span class="at">main =</span> <span class="st">"Complete Linkage Dendrogram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="평균-연결법-average-linkage" class="level3" data-number="10.5.5">
<h3 data-number="10.5.5" class="anchored" data-anchor-id="평균-연결법-average-linkage"><span class="header-section-number">10.5.5</span> 평균 연결법 (Average Linkage)</h3>
<p>평균 연결법은 두 군집 내의 모든 관측값 쌍에 대해 거리를 계산하고, <strong>평균값을 기준</strong>으로 병합을 결정한다. 이 방법은 극단값에 덜 민감하며, <strong>균형 잡힌 군집 구조</strong>를 도출할 수 있다.</p>
<section id="외식산업-예시-2" class="level4" data-number="10.5.5.1">
<h4 data-number="10.5.5.1" class="anchored" data-anchor-id="외식산업-예시-2"><span class="header-section-number">10.5.5.1</span> 외식산업 예시</h4>
<p>프랜차이즈 카페가 지역별 고객을 분석할 때, <strong>지출이 약간씩 다르지만 평균적으로 비슷한 고객들</strong>을 그룹화하는 데 적합하다. 극단적인 VIP 고객이 군집을 왜곡시키지 않는다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>hc_average <span class="ot">&lt;-</span> <span class="fu">hclust</span>(gower_dist, <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_average, <span class="at">labels =</span> customer_pos<span class="sc">$</span>id, <span class="at">main =</span> <span class="st">"Average Linkage Dendrogram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="중심-연결법-centroid-method" class="level3" data-number="10.5.6">
<h3 data-number="10.5.6" class="anchored" data-anchor-id="중심-연결법-centroid-method"><span class="header-section-number">10.5.6</span> 중심 연결법 (Centroid Method)</h3>
<p>군집 내 평균값(중심점)을 계산한 후, 군집 간 중심점 간의 거리로 병합 여부를 판단한다. 하지만 두 군집의 중심점이 병합 과정에서 <strong>이전보다 더 가까워질 수 있는 역전 현상</strong>이 발생할 수 있다.</p>
<section id="외식산업-예시-3" class="level4" data-number="10.5.6.1">
<h4 data-number="10.5.6.1" class="anchored" data-anchor-id="외식산업-예시-3"><span class="header-section-number">10.5.6.1</span> 외식산업 예시</h4>
<p>도시락 배달 업체에서 <strong>근무시간별 주문 중심 시간대</strong>를 비교할 때 사용할 수 있다. 예를 들어 점심시간과 이른 저녁시간 군집은 중심이 가까우면 병합될 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>hc_centroid <span class="ot">&lt;-</span> <span class="fu">hclust</span>(gower_dist, <span class="at">method =</span> <span class="st">"centroid"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_centroid, <span class="at">labels =</span> customer_pos<span class="sc">$</span>id, <span class="at">main =</span> <span class="st">"Centroid Method Dendrogram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="ward-연결법-wards-method" class="level3" data-number="10.5.7">
<h3 data-number="10.5.7" class="anchored" data-anchor-id="ward-연결법-wards-method"><span class="header-section-number">10.5.7</span> Ward 연결법 (Ward’s Method)</h3>
<p>Ward 방법은 군집 병합 시 <strong>오차제곱합(ESS)의 증가량이 가장 작도록</strong> 병합을 결정한다. 이 방식은 군집 내 분산을 최소화하는 방향으로 진행되며, 결과적으로 <strong>내부 응집력이 높은 군집 구조</strong>를 생성한다.</p>
<section id="외식산업-예시-4" class="level4" data-number="10.5.7.1">
<h4 data-number="10.5.7.1" class="anchored" data-anchor-id="외식산업-예시-4"><span class="header-section-number">10.5.7.1</span> 외식산업 예시</h4>
<p>피자 프랜차이즈가 <strong>가맹점별 월 매출, 프로모션 참여도, 메뉴 수익률</strong>을 기준으로 가맹점을 군집화할 경우, Ward 방법은 <strong>비슷한 경영 성과를 가진 매장</strong>을 하나의 그룹으로 묶을 수 있어 실무 적용성이 높다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>hc_ward <span class="ot">&lt;-</span> <span class="fu">hclust</span>(gower_dist, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_ward, <span class="at">labels =</span> customer_pos<span class="sc">$</span>id, <span class="at">main =</span> <span class="st">"Ward's Method Dendrogram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="알고리즘-비교-요약표" class="level3" data-number="10.5.8">
<h3 data-number="10.5.8" class="anchored" data-anchor-id="알고리즘-비교-요약표"><span class="header-section-number">10.5.8</span> 알고리즘 비교 요약표</h3>
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 20%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">알고리즘</th>
<th style="text-align: center;">군집 간 거리 기준</th>
<th style="text-align: center;">장점</th>
<th style="text-align: center;">단점</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">단일 연결법</td>
<td style="text-align: center;">가장 가까운 점</td>
<td style="text-align: center;">연결성 강조</td>
<td style="text-align: center;">체인 효과, 아웃라이어 민감</td>
</tr>
<tr class="even">
<td style="text-align: center;">완전 연결법</td>
<td style="text-align: center;">가장 먼 점</td>
<td style="text-align: center;">응집력 높은 군집</td>
<td style="text-align: center;">과도한 분리 가능성</td>
</tr>
<tr class="odd">
<td style="text-align: center;">평균 연결법</td>
<td style="text-align: center;">모든 점의 평균 거리</td>
<td style="text-align: center;">균형적 구조</td>
<td style="text-align: center;">중심이 모호할 수 있음</td>
</tr>
<tr class="even">
<td style="text-align: center;">중심 연결법</td>
<td style="text-align: center;">군집 중심 간 거리</td>
<td style="text-align: center;">직관적 해석</td>
<td style="text-align: center;">중심 이동으로 오류 가능</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Ward 방법</td>
<td style="text-align: center;">ESS 증가 최소화</td>
<td style="text-align: center;">분산 최소화, 응집력 강함</td>
<td style="text-align: center;">비구형 군집에는 부적합</td>
</tr>
</tbody>
</table>
</section>
<section id="다양한-알고리즘-시각화-비교" class="level3" data-number="10.5.9">
<h3 data-number="10.5.9" class="anchored" data-anchor-id="다양한-알고리즘-시각화-비교"><span class="header-section-number">10.5.9</span> 다양한 알고리즘 시각화 비교</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 군집 결과 비교용 tanglegram</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_single)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_complete)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_average)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_ward)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tanglegram</span>(d1, d4, <span class="at">main =</span> <span class="st">"Single vs Ward"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: colorspace</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tanglegram</span>(d2, d4, <span class="at">main =</span> <span class="st">"Complete vs Ward"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tanglegram</span>(d3, d4, <span class="at">main =</span> <span class="st">"Average vs Ward"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ward 방법 기반 클러스터 결과 추가</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>cluster_result <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc_ward, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>customer_pos<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(cluster_result)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 클러스터별 요약 통계</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> customer_pos <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_visit =</span> <span class="fu">mean</span>(visit_freq),</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_spend =</span> <span class="fu">mean</span>(avg_spend),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">weekday_ratio =</span> <span class="fu">mean</span>(day_pref <span class="sc">==</span> <span class="st">"weekday"</span>),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">coffee_ratio =</span> <span class="fu">mean</span>(menu_pref <span class="sc">==</span> <span class="st">"coffee"</span>),</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  cluster mean_visit mean_spend weekday_ratio coffee_ratio     n
  &lt;fct&gt;        &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt; &lt;int&gt;
1 1            14.9      18140.         0.373        0.18    150
2 2             4.23      8295.         0            0.480   102
3 3             3.57      6920.         1            0.569   248</code></pre>
</div>
</div>
<p>군집분석을 한 뒤에 결과를 리포팅하는 많은 경우를 보았지만 대부분은 <strong>왜 이런 결과가 나왔고, 의미는 무엇이며, 왜 이렇게 해야하는지</strong> 등에 대한 이해나 설명이 없는 경우가 대부분이다. 군집분석은 <strong>p-value가 있는 것도 아니고, 라벨이 없는 비지도학습 기반의 머신러닝</strong>이기 때문에 사실상 <strong>정답이 없다.</strong> 분석가가 제대로 이해를 하지 못한 상태로 이렇게 결과가 나왔으니 내 잘못은 아니다라는 식의 접근이 문제인 것이다. <strong>분석은 한 번에 끝날 수 없다.</strong> 다양한 방법을 통해 분석을 해보고 그 결과를 비교하면서 데이터를 이해하고 결과를 해석하면서 가장 논리적이고 비즈니스 인사이트를 끌어낼 수 있는 분석결과를 리포팅 해야하는 것이다.</p>
</section>
<section id="결론-알고리즘-선택은-전략의-출발점" class="level3" data-number="10.5.10">
<h3 data-number="10.5.10" class="anchored" data-anchor-id="결론-알고리즘-선택은-전략의-출발점"><span class="header-section-number">10.5.10</span> 결론: 알고리즘 선택은 전략의 출발점</h3>
<p>외식산업에서 군집 알고리즘을 선택하는 것은 단순한 통계 기법 선택이 아니라, <strong>마케팅 전략, 운영 전략, 신메뉴 개발 전략의 출발점</strong>이다. 예를 들어 Ward 방법은 <strong>가장 실무에서 많이 활용</strong>되지만, 단일 연결법은 <strong>비정형적인 소비패턴 분석</strong>에, 완전 연결법은 <strong>보수적인 분류</strong>에 적합하다. 다양한 방법을 실험해 보고, <strong>해석 가능한 결과를 도출하는 것</strong>이 분석가의 가장 중요한 역할이다.</p>
</section>
</section>
<section id="계층적-군집분석-실습-프랜차이즈-매장-고객-군집" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="계층적-군집분석-실습-프랜차이즈-매장-고객-군집"><span class="header-section-number">10.6</span> 계층적 군집분석 실습: 프랜차이즈 매장 고객 군집</h2>
<p>고객의 행동은 복잡하고 예측하기 어렵지만, 패턴을 발견할 수 있다면 기업은 더 나은 전략을 수립할 수 있다. 프랜차이즈 외식 매장에서는 고객의 구매금액, 방문빈도, 만족도 등을 종합적으로 고려하여 유사한 고객군을 식별하고 이를 마케팅과 운영 전략에 반영하려는 시도가 활발하다. 이 절에서는 실제 시뮬레이션된 외식 고객 데이터를 활용하여 계층적 군집분석을 수행하고, 알고리즘 선택에 따른 결과 차이와 비즈니스적 시사점을 도출한다.</p>
<section id="분석에-사용된-변수" class="level3" data-number="10.6.1">
<h3 data-number="10.6.1" class="anchored" data-anchor-id="분석에-사용된-변수"><span class="header-section-number">10.6.1</span> 분석에 사용된 변수</h3>
<p>이번 분석에서 사용된 고객 데이터는 총 500명의 프랜차이즈 매장 방문 고객을 기반으로 하며, 다음과 같은 변수로 구성된다.</p>
<table class="table-striped table-hover table">
<thead>
<tr class="header">
<th style="text-align: center;">변수명</th>
<th style="text-align: center;">설명</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>purchase_amount</code></td>
<td style="text-align: center;">1회 평균 구매금액 (원)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>visit_frequency</code></td>
<td style="text-align: center;">월간 방문 빈도 (회)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>satisfaction</code></td>
<td style="text-align: center;">고객 만족도 (1–5 Likert Scale)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>weekday_visit_ratio</code></td>
<td style="text-align: center;">평일 방문 비율 (0–1 사이 비율)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>promotion_response</code></td>
<td style="text-align: center;">프로모션 반응도 (이벤트 참여 비율)</td>
</tr>
</tbody>
</table>
<p>이 변수들은 <strong>고객의 구매 행동</strong>, <strong>충성도</strong>, <strong>가격 민감도</strong>, <strong>마케팅 반응성</strong> 등을 반영할 수 있으며, 이들을 조합해 <strong>정량적인 거리 기반 유사성 판단</strong>이 가능하다.</p>
</section>
<section id="분석-데이터-생성-및-구조-확인" class="level3" data-number="10.6.2">
<h3 data-number="10.6.2" class="anchored" data-anchor-id="분석-데이터-생성-및-구조-확인"><span class="header-section-number">10.6.2</span> 분석 데이터 생성 및 구조 확인</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>cluster_A <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">purchase_amount =</span> <span class="fu">rnorm</span>(<span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">20000</span>, <span class="at">sd =</span> <span class="dv">3000</span>),</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">visit_frequency =</span> <span class="fu">rpois</span>(<span class="dv">180</span>, <span class="at">lambda =</span> <span class="dv">12</span>),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">satisfaction =</span> <span class="fu">rnorm</span>(<span class="dv">180</span>, <span class="at">mean =</span> <span class="fl">4.5</span>, <span class="at">sd =</span> <span class="fl">0.3</span>),</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">weekday_visit_ratio =</span> <span class="fu">runif</span>(<span class="dv">180</span>, <span class="fl">0.6</span>, <span class="fl">0.9</span>),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">promotion_response =</span> <span class="fu">runif</span>(<span class="dv">180</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>cluster_B <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">purchase_amount =</span> <span class="fu">rnorm</span>(<span class="dv">170</span>, <span class="at">mean =</span> <span class="dv">10000</span>, <span class="at">sd =</span> <span class="dv">2000</span>),</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">visit_frequency =</span> <span class="fu">rpois</span>(<span class="dv">170</span>, <span class="at">lambda =</span> <span class="dv">6</span>),</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">satisfaction =</span> <span class="fu">rnorm</span>(<span class="dv">170</span>, <span class="at">mean =</span> <span class="fl">3.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">weekday_visit_ratio =</span> <span class="fu">runif</span>(<span class="dv">170</span>, <span class="fl">0.3</span>, <span class="fl">0.6</span>),</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">promotion_response =</span> <span class="fu">runif</span>(<span class="dv">170</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>cluster_C <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">purchase_amount =</span> <span class="fu">rnorm</span>(<span class="dv">150</span>, <span class="at">mean =</span> <span class="dv">6000</span>, <span class="at">sd =</span> <span class="dv">1500</span>),</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">visit_frequency =</span> <span class="fu">rpois</span>(<span class="dv">150</span>, <span class="at">lambda =</span> <span class="dv">2</span>),</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">satisfaction =</span> <span class="fu">rnorm</span>(<span class="dv">150</span>, <span class="at">mean =</span> <span class="fl">2.5</span>, <span class="at">sd =</span> <span class="fl">0.7</span>),</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">weekday_visit_ratio =</span> <span class="fu">runif</span>(<span class="dv">150</span>, <span class="fl">0.1</span>, <span class="fl">0.4</span>),</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">promotion_response =</span> <span class="fu">runif</span>(<span class="dv">150</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>customer_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cluster_A, cluster_B, cluster_C)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>customer_data <span class="ot">&lt;-</span> customer_data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">customer_id =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, <span class="dv">1</span><span class="sc">:</span>n))</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(customer_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> purchase_amount visit_frequency   satisfaction    weekday_visit_ratio
 Min.   : 2472   Min.   : 0.000   Min.   :0.6876   Min.   :0.1039     
 1st Qu.: 6922   1st Qu.: 3.000   1st Qu.:2.7426   1st Qu.:0.3214     
 Median :10475   Median : 6.000   Median :3.7029   Median :0.4818     
 Mean   :12374   Mean   : 6.906   Mean   :3.5234   Mean   :0.4976     
 3rd Qu.:18586   3rd Qu.:10.000   3rd Qu.:4.3625   3rd Qu.:0.6834     
 Max.   :29723   Max.   :23.000   Max.   :5.2314   Max.   :0.8997     
 promotion_response customer_id       
 Min.   :0.1009     Length:500        
 1st Qu.:0.2367     Class :character  
 Median :0.3664     Mode  :character  
 Mean   :0.4312                       
 3rd Qu.:0.6280                       
 Max.   :0.8998                       </code></pre>
</div>
</div>
</section>
<section id="거리-측정-및-군집-알고리즘-적용" class="level3" data-number="10.6.3">
<h3 data-number="10.6.3" class="anchored" data-anchor-id="거리-측정-및-군집-알고리즘-적용"><span class="header-section-number">10.6.3</span> 거리 측정 및 군집 알고리즘 적용</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="ot">&lt;-</span> <span class="fu">scale</span>(customer_data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>dist_euc <span class="ot">&lt;-</span> <span class="fu">dist</span>(scaled_data, <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>hc_single <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_euc, <span class="at">method =</span> <span class="st">"single"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>hc_complete <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_euc, <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>hc_average <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_euc, <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>hc_ward <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_euc, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="알고리즘별-덴드로그램-시각화" class="level3" data-number="10.6.4">
<h3 data-number="10.6.4" class="anchored" data-anchor-id="알고리즘별-덴드로그램-시각화"><span class="header-section-number">10.6.4</span> 알고리즘별 덴드로그램 시각화</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hc_single, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">"Single Linkage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hc_complete, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">"Complete Linkage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hc_average, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">"Average Linkage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-23-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hc_ward, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">"Ward's Method"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter10_files/figure-html/unnamed-chunk-23-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ward-방법에-기반한-군집-결과-해석" class="level3" data-number="10.6.5">
<h3 data-number="10.6.5" class="anchored" data-anchor-id="ward-방법에-기반한-군집-결과-해석"><span class="header-section-number">10.6.5</span> Ward 방법에 기반한 군집 결과 해석</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>customer_data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(hc_ward, <span class="at">k =</span> <span class="dv">3</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>customer_data <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">|&gt;</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    평균_구매금액 <span class="ot">=</span> <span class="fu">mean</span>(purchase_amount),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    평균_방문빈도 <span class="ot">=</span> <span class="fu">mean</span>(visit_frequency),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    평균_만족도 <span class="ot">=</span> <span class="fu">mean</span>(satisfaction),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    평균_평일방문비율 <span class="ot">=</span> <span class="fu">mean</span>(weekday_visit_ratio),</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    평균_프로모션반응 <span class="ot">=</span> <span class="fu">mean</span>(promotion_response),</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    고객수 <span class="ot">=</span> <span class="fu">n</span>()</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  cluster 평균_구매금액 평균_방문빈도 평균_만족도 평균_평일방문비율
  &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;             &lt;dbl&gt;
1 1              20016.         12.0         4.46             0.744
2 2               9855.          5.83        3.50             0.447
3 3               5983.          1.97        2.40             0.256
# ℹ 2 more variables: 평균_프로모션반응 &lt;dbl&gt;, 고객수 &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="군집-해석-및-인사이트-도출" class="level3" data-number="10.6.6">
<h3 data-number="10.6.6" class="anchored" data-anchor-id="군집-해석-및-인사이트-도출"><span class="header-section-number">10.6.6</span> 군집 해석 및 인사이트 도출</h3>
<p>Ward 알고리즘에 기반한 군집은 다음과 같은 고객 특성을 보여준다.</p>
<ol type="1">
<li><p>첫 번째 군집은 높은 만족도와 구매금액을 가진 <strong>우수고객층</strong>으로 구성되어 있다. 이들은 프로모션에도 반응이 좋고, 평일에 자주 방문한다. 기업 입장에서 <strong>이탈 방지 전략이 반드시 필요하다</strong>.</p></li>
<li><p>두 번째 군집은 중간 수준의 구매금액과 만족도를 보이며, 방문빈도도 적당하다. 이 고객군은 <strong>충성고객으로 전환될 가능성</strong>이 높다.</p></li>
<li><p>세 번째 군집은 구매금액과 만족도가 모두 낮고, 방문빈도도 낮다. 이 고객은 일회성 방문객일 가능성이 높다.</p></li>
</ol>
</section>
<section id="실습을-통해-얻은-결론" class="level3" data-number="10.6.7">
<h3 data-number="10.6.7" class="anchored" data-anchor-id="실습을-통해-얻은-결론"><span class="header-section-number">10.6.7</span> 실습을 통해 얻은 결론</h3>
<p>고객 데이터를 기반으로 한 계층적 군집분석은 단순히 고객을 구분하는 것을 넘어서, <strong>각 군집의 행동 패턴과 마케팅 전략 방향을 도출하는 데 강력한 도구</strong>가 된다. 동일한 데이터를 사용하더라도 <strong>거리 측정 방식</strong>과 <strong>군집 알고리즘 선택</strong>에 따라 결과가 달라질 수 있으므로, <strong>여러 가지 방법을 비교하고 해석하는 실험적 접근</strong>이 필요하다.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter9.html" class="pagination-link  aria-label=" &lt;span="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">요인분석</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter11.html" class="pagination-link" aria-label="<span class='chapter-number'>11</span>&nbsp; <span class='chapter-title'>k-평균 군집분석</span>">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">k-평균 군집분석</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>